const Web3 = require('web3');
var Tx = require('ethereumjs-tx');
let fs = require("fs");



// Web3 Initialisation
const provider = 'http://192.168.33.115:8545';
console.log("******************************************");
console.log("Using provider : " + provider);
console.log("******************************************");
var web3 = new Web3(new Web3.providers.HttpProvider(provider))


//////////////////////////////////////Account info for deployment///////////////////////////////////////////////////
var account1= "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73";
var key1 =new Buffer.from('8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63','hex');
/////////////////////////////////////////////////////////////////////////////////////////:

// Read the compiled contract code
// Compile with
// solc SampleContract.sol --combined-json abi,asm,ast,bin,bin-runtime,clone-bin,devdoc,interface,opcodes,srcmap,srcmap-runtime,userdoc > contracts.json
// let source = fs.readFileSync("/home/rsx14/IdeaProjects/PIR/Solidity/contracts.json");
// let contracts = JSON.parse(source)["contracts"];

// ABI description as JSON structure
let abi = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"fund","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"}],"name":"NewClient","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"provider","type":"address"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"redeemFunds","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"minimumData","type":"uint128"},{"indexed":false,"internalType":"uint128","name":"deployTime","type":"uint128"},{"indexed":false,"internalType":"uint128","name":"endTime","type":"uint128"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint8","name":"depreciationType","type":"uint8"},{"indexed":false,"internalType":"string","name":"description","type":"string"}],"name":"NewDataReference","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encryptedEncodedKey","type":"bytes32"}],"name":"encryptedEncodedKeyEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encryptedKeyHash","type":"bytes32"}],"name":"encryptedKeyHash","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"keyDecoder","type":"uint256"}],"name":"keyDecoder","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"referenceKey","type":"uint256"}],"name":"referenceKey","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"funds","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"withdrawRefund","type":"event"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"}],"name":"buyReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_price","type":"uint256"},{"internalType":"uint128","name":"_minimumData","type":"uint128"},{"internalType":"uint128","name":"_referenceDuration","type":"uint128"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"},{"internalType":"uint8","name":"_depreciationType","type":"uint8"},{"internalType":"string","name":"_description","type":"string"}],"name":"createDataReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"dataReferences","outputs":[{"internalType":"uint256","name":"initialPrice","type":"uint256"},{"internalType":"uint256","name":"redeemFunds","type":"uint256"},{"internalType":"uint256","name":"referenceKey","type":"uint256"},{"internalType":"uint128","name":"minimumData","type":"uint128"},{"internalType":"uint128","name":"numberOfData","type":"uint128"},{"internalType":"uint128","name":"deployTime","type":"uint128"},{"internalType":"uint128","name":"endTime","type":"uint128"},{"internalType":"uint8","name":"depreciationType","type":"uint8"},{"internalType":"address","name":"provider","type":"address"},{"internalType":"uint256","name":"withdrawableFunds","type":"uint256"},{"internalType":"uint128","name":"numberOfDisputes","type":"uint128"},{"internalType":"uint128","name":"completedClients","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClientDisputes","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClients","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getNumberOfData","outputs":[{"internalType":"uint128","name":"numberOfData","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getReferenceCurrentPrice","outputs":[{"internalType":"uint256","name":"price","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"raiseDispute","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_encryptedEncodedKey","type":"bytes32"}],"name":"setEncryptedEncodedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_encryptedKeyHash","type":"bytes32"}],"name":"setEncryptedHashedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"uint256","name":"_keyDecoder","type":"uint256"}],"name":"setKeyDecoder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"uint256","name":"_referenceKey","type":"uint256"}],"name":"setReferenceKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"withdrawFunds","outputs":[],"stateMutability":"nonpayable","type":"function"}];

//[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]



// Smart contract EVM bytecode as hex
let code = '0x' + "60806040526000805566470de4df82000060025534801561001f57600080fd5b506127b28061002f6000396000f3fe6080604052600436106100c25760003560e01c80637a5087fb1161007f578063b07a3b6611610059578063b07a3b66146105dc578063b14b678714610621578063e3752bbe14610686578063ed95710014610716576100c2565b80637a5087fb1461041a5780637d918a251461052e578063a5c1674e146105a1576100c2565b806307bbb8d4146100c75780630d222dea146100ff578063155dd5ee1461016457806342dd519c1461019f57806370f383141461022f578063718524ac146103d5575b600080fd5b6100fd600480360360408110156100dd57600080fd5b810190808035906020019092919080359060200190929190505050610765565b005b34801561010b57600080fd5b506101626004803603606081101561012257600080fd5b8101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610a94565b005b34801561017057600080fd5b5061019d6004803603602081101561018757600080fd5b8101908080359060200190929190505050610d05565b005b3480156101ab57600080fd5b506101d8600480360360208110156101c257600080fd5b8101908080359060200190929190505050610e98565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561021b578082015181840152602081019050610200565b505050509050019250505060405180910390f35b34801561023b57600080fd5b506102686004803603602081101561025257600080fd5b8101908080359060200190929190505050610fbc565b604051808d81526020018c81526020018b81526020018a6fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168152602001896fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168152602001886fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168152602001876fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018660ff1660ff1681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001848152602001836fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168152602001826fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020019c5050505050505050505050505060405180910390f35b3480156103e157600080fd5b50610418600480360360408110156103f857600080fd5b8101908080359060200190929190803590602001909291905050506110fe565b005b61052c600480360360c081101561043057600080fd5b810190808035906020019092919080356fffffffffffffffffffffffffffffffff16906020019092919080356fffffffffffffffffffffffffffffffff16906020019092919080359060200190929190803560ff169060200190929190803590602001906401000000008111156104a657600080fd5b8201836020820111156104b857600080fd5b803590602001918460018302840111640100000000831117156104da57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050611291565b005b34801561053a57600080fd5b506105676004803603602081101561055157600080fd5b8101908080359060200190929190505050611795565b60405180826fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3480156105ad57600080fd5b506105da600480360360208110156105c457600080fd5b81019080803590602001909291905050506117d9565b005b3480156105e857600080fd5b5061061f600480360360408110156105ff57600080fd5b810190808035906020019092919080359060200190929190505050611cc3565b005b34801561062d57600080fd5b506106846004803603606081101561064457600080fd5b8101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050611dc2565b005b34801561069257600080fd5b506106bf600480360360208110156106a957600080fd5b8101908080359060200190929190505050611e8e565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156107025780820151818401526020810190506106e7565b505050509050019250505060405180910390f35b34801561072257600080fd5b5061074f6004803603602081101561073957600080fd5b81019080803590602001909291905050506120f0565b6040518082815260200191505060405180910390f35b8160006001828154811061077557fe5b90600052602060002090600d0201600201541461079157600080fd5b6001818154811061079e57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1642106107e957600080fd5b60006107f4826120f0565b90508034101561080357600080fd5b6001828154811061081057fe5b90600052602060002090600d02016000015434111561082e57600080fd5b60018054905084111561084057600080fd5b600015156001858154811061085157fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161515146108b957600080fd5b600184815481106108c657fe5b90600052602060002090600d0201600701339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600180858154811061094657fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690831515021790555034600185815481106109b957fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055503460018581548110610a1957fe5b90600052602060002090600d0201600601600082825401925050819055503373ffffffffffffffffffffffffffffffffffffffff16847fef284047b82f7c7b42032946386a3f8dfd2d4e7c74f9d59242e374620a1e8a523486604051808381526020018281526020019250505060405180910390a350505050565b8260018181548110610aa257fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b0b57600080fd5b600060018581548110610b1a57fe5b90600052602060002090600d020160080160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541115610cff57600060018581548110610b7e57fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541415610cfe578160018581548110610be157fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555060018481548110610c4057fe5b90600052602060002090600d0201600a01601081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550508273ffffffffffffffffffffffffffffffffffffffff16847f18867905c35c77de44f5c248899c39aefcc43144782339e6d2233112022ed884846040518082815260200191505060405180910390a35b5b50505050565b8060018181548110610d1357fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610d7c57600080fd5b6206978060018381548110610d8d57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16016fffffffffffffffffffffffffffffffff164211610dd957600080fd5b600060018381548110610de857fe5b90600052602060002090600d0201600201541415610e0557600080fd5b600060018381548110610e1457fe5b90600052602060002090600d0201600601549050600060018481548110610e3757fe5b90600052602060002090600d0201600601819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015610e92573d6000803e3d6000fd5b50505050565b60608160018181548110610ea857fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610f1157600080fd5b60018381548110610f1e57fe5b90600052602060002090600d0201600701805480602002602001604051908101604052809291908181526020018280548015610faf57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311610f65575b5050505050915050919050565b60018181548110610fc957fe5b90600052602060002090600d02016000915090508060000154908060010154908060020154908060030160009054906101000a90046fffffffffffffffffffffffffffffffff16908060030160109054906101000a90046fffffffffffffffffffffffffffffffff16908060040160009054906101000a90046fffffffffffffffffffffffffffffffff16908060040160109054906101000a90046fffffffffffffffffffffffffffffffff16908060050160009054906101000a900460ff16908060050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff169080600601549080600a0160009054906101000a90046fffffffffffffffffffffffffffffffff169080600a0160109054906101000a90046fffffffffffffffffffffffffffffffff1690508c565b81600115156001828154811061111057fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461117857600080fd5b6000801b6001848154811061118957fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141561123d5781600184815481106111ec57fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002050505b3373ffffffffffffffffffffffffffffffffffffffff16837f8a8e57e77f82d72176351fb8deea0f031046ad9629b15591a67e542e70317661846040518082815260200191505060405180910390a3505050565b6112996125c2565b868160000181815250503481602001818152505034816101200181815250508581606001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff1681525050828160e0019060ff16908160ff1681525050428160a001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff16815250504285018160c001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff1681525050426fffffffffffffffffffffffffffffffff168160c001516fffffffffffffffffffffffffffffffff161161139057600080fd5b3381610100019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505060018190806001815401808255809150506001900390600052602060002090600d020160009091909190915060008201518160000155602082015181600101556040820151816002015560608201518160030160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060808201518160030160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060a08201518160040160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060c08201518160040160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060e08201518160050160006101000a81548160ff021916908360ff1602179055506101008201518160050160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061012082015181600601556101408201518160070190805190602001906115a09291906126af565b5061016082015181600a0160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555061018082015181600a0160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050503373ffffffffffffffffffffffffffffffffffffffff1660018080549050037f87df291311b02f282c5dcfc847fe75d49b00eded0dff5c3b8a5e9110ccca8e2e89348a428760c001518b8b8b60405180898152602001888152602001876fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168152602001866fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168152602001856fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018481526020018360ff1660ff16815260200180602001828103825283818151815260200191508051906020019080838360005b8381101561174b578082015181840152602081019050611730565b50505050905090810190601f1680156117785780820380516001836020036101000a031916815260200191505b50995050505050505050505060405180910390a350505050505050565b6000600182815481106117a457fe5b90600052602060002090600d020160030160109054906101000a90046fffffffffffffffffffffffffffffffff169050919050565b8060011515600182815481106117eb57fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461185357600080fd5b60006001838154811061186257fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050600081116118c057600080fd5b80600184815481106118ce57fe5b90600052602060002090600d02016006015410156118eb57600080fd5b6000600184815481106118fa57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141561195e576119598382612365565b611cbe565b60006001848154811061196d57fe5b90600052602060002090600d02016002015414611c5d5760006001848154811061199357fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054600185815481106119ef57fe5b90600052602060002090600d02016002015418905060018481548110611a1157fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205481604051602001808281526020019150506040516020818303038152906040528051906020012014611b2357611b1260018581548110611a9c57fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1660018681548110611ae957fe5b90600052602060002090600d02016001015481611b0257fe5b048361253a90919063ffffffff16565b9150611b1e8483612365565b611c57565b60018481548110611b3057fe5b90600052602060002090600d020160030160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1660018581548110611b7d57fe5b90600052602060002090600d020160030160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161015611c5657611c4960018581548110611bd357fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1660018681548110611c2057fe5b90600052602060002090600d02016001015481611c3957fe5b048361253a90919063ffffffff16565b9150611c558483612365565b5b5b50611cbd565b60018381548110611c6a57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16421115611cbc57611cbb8382612365565b5b5b5b505050565b8160018181548110611cd157fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611d3a57600080fd5b600060018481548110611d4957fe5b90600052602060002090600d0201600201541415611dbd578160018481548110611d6f57fe5b90600052602060002090600d020160020181905550827fe8c4ae2657e816301c69b1eca56ae2e769762e8e6a8fb457b876b0a6228bbc2c836040518082815260200191505060405180910390a25b505050565b8260018181548110611dd057fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611e3957600080fd5b8273ffffffffffffffffffffffffffffffffffffffff16847fd57e7ea23bb50dbe8316bec30809240f566976ab1b1e4e37e76c7bb3e0b645f0846040518082815260200191505060405180910390a350505050565b60608160018181548110611e9e57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611f0757600080fd5b600060018481548110611f1657fe5b90600052602060002090600d0201600a0160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16905060608167ffffffffffffffff81118015611f7157600080fd5b50604051908082528060200260200182016040528015611fa05781602001602082028036833780820191505090505b509050600080600090505b60018781548110611fb857fe5b90600052602060002090600d0201600701805490508110156120e35760018781548110611fe157fe5b90600052602060002090600d02016007018181548110611ffd57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915060006001888154811061203957fe5b90600052602060002090600d020160080160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414156120d6578183828151811061209b57fe5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505b8080600101915050611fab565b5081945050505050919050565b6000806001838154811061210057fe5b90600052602060002090600d020160000154905060006001848154811061212357fe5b90600052602060002090600d020160050160009054906101000a900460ff16905060018160ff1614156122475760006001858154811061215f57fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166001868154811061219a57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16036fffffffffffffffffffffffffffffffff1690506000600186815481106121ec57fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1642039050818185028161223b57fe5b0484039350505061235b565b60028160ff16141561235a5760006001858154811061226257fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166001868154811061229d57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16036fffffffffffffffffffffffffffffffff1690506000600186815481106122ef57fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff164203905083828286600202028161234257fe5b0483840283848802028161235257fe5b040301935050505b5b8192505050919050565b806001838154811061237357fe5b90600052602060002090600d020160060154101561239057600080fd5b6001828154811061239d57fe5b90600052602060002090600d0201600a01600081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505060006001838154811061241a57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550806001838154811061247a57fe5b90600052602060002090600d0201600601600082825403925050819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050501580156124de573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff16827f54cd3e4964cbbb07875e24bd38c626e4572701f70d0992629dfbad3a0a6597ec8342604051808381526020018281526020019250505060405180910390a35050565b6000808284019050838110156125b8576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f536166654d6174683a206164646974696f6e206f766572666c6f77000000000081525060200191505060405180910390fd5b8091505092915050565b604051806101a0016040528060008152602001600081526020016000815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff168152602001600060ff168152602001600073ffffffffffffffffffffffffffffffffffffffff168152602001600081526020016060815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff1681525090565b828054828255906000526020600020908101928215612728579160200282015b828111156127275782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550916020019190600101906126cf565b5b5090506127359190612739565b5090565b61277991905b8082111561277557600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555060010161273f565b5090565b9056fea26469706673582212205eb6bc8bf846cc5959c2390bc86f89817e22450d14dc5badfa73b8c7d5b5526164736f6c63430006080033";


//
// Create Contract proxy class
let SampleContract = new web3.eth.Contract(abi);
const gasPrice = 1000;//web3.eth.gasPrice;
const gasPriceHex = web3.utils.numberToHex(gasPrice);
const gasLimitHex = web3.utils.numberToHex(4500000);


(async () => {
    const nonceval = await web3.eth.getTransactionCount(account1, "pending"); //'0x' + new Date().getTime();

    console.log(nonceval);

    var fTx = {
        nonce: nonceval,
        gasPrice: gasPriceHex,
        gasLimit: gasLimitHex,
        data: code,
        from: account1
    };

    var txx = new Tx(fTx);
    txx.sign(key1);

    var sTx =txx.serialize();


    const receipt = await web3.eth.sendSignedTransaction('0x' + sTx.toString('hex')).on('receipt', function(receipt){
        console.log(receipt);
    });
})();
