const Web3 = require('web3');
var Tx = require('ethereumjs-tx');
let fs = require("fs");



// Web3 Initialisation
const provider = 'http://192.168.33.115:8545';
console.log("******************************************");
console.log("Using provider : " + provider);
console.log("******************************************");
var web3 = new Web3(new Web3.providers.HttpProvider(provider))


//////////////////////////////////////Account info for deployment///////////////////////////////////////////////////
var account1= "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73";
var key1 =new Buffer.from('8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63','hex');
/////////////////////////////////////////////////////////////////////////////////////////:

// Read the compiled contract code
// Compile with
// solc SampleContract.sol --combined-json abi,asm,ast,bin,bin-runtime,clone-bin,devdoc,interface,opcodes,srcmap,srcmap-runtime,userdoc > contracts.json
// let source = fs.readFileSync("/home/rsx14/IdeaProjects/PIR/Solidity/contracts.json");
// let contracts = JSON.parse(source)["contracts"];

// ABI description as JSON structure

let abi = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encodedKeyHash","type":"bytes32"}],"name":"encodedKeyHash","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encryptedEncodedKey","type":"bytes32"}],"name":"encryptedEncodedKeyEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"keyDecoder","type":"bytes32"}],"name":"keyDecoder","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"fund","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"newClient","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"provider","type":"address"},{"indexed":false,"internalType":"uint256","name":"initialPrice","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"insuranceDeposit","type":"uint256"},{"indexed":false,"internalType":"uint64","name":"minimumData","type":"uint64"},{"indexed":false,"internalType":"uint64","name":"deployTime","type":"uint64"},{"indexed":false,"internalType":"uint64","name":"endTime","type":"uint64"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint8","name":"depreciationType","type":"uint8"},{"indexed":false,"internalType":"string","name":"description","type":"string"}],"name":"newDataReference","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"string","name":"spaceObject","type":"string"}],"name":"newTLE","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"referenceKey","type":"bytes32"}],"name":"referenceKey","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"_referenceId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"funds","type":"uint256"}],"name":"withdrawFundsEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"funds","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"withdrawRefund","type":"event"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"TLEs","outputs":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"bytes25","name":"TLE1","type":"bytes25"},{"internalType":"bytes25","name":"TLE2","type":"bytes25"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"}],"name":"buyReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_initialPrice","type":"uint256"},{"internalType":"uint64","name":"_minimumData","type":"uint64"},{"internalType":"uint64","name":"_referenceDuration","type":"uint64"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"},{"internalType":"uint8","name":"_depreciationType","type":"uint8"},{"internalType":"string","name":"_description","type":"string"}],"name":"createDataReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClientDisputes","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClients","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceKey","type":"uint256"}],"name":"getKeyDecoder","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getNumberOfData","outputs":[{"internalType":"uint128","name":"numberOfData","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getReferenceCurrentPrice","outputs":[{"internalType":"uint256","name":"price","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getTLEs","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"components":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"bytes25","name":"TLE1","type":"bytes25"},{"internalType":"bytes25","name":"TLE2","type":"bytes25"}],"internalType":"struct TLE_Contract.structTLE[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"raiseDispute","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_encodedKeyHash","type":"bytes32"}],"name":"setEncodedHashedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_encryptedEncodedKey","type":"bytes32"}],"name":"setEncryptedEncodedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_keyDecoder","type":"bytes32"}],"name":"setKeyDecoder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_referenceKey","type":"bytes32"}],"name":"setReferenceKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"string","name":"_spaceObject","type":"string"},{"internalType":"bytes25","name":"_TLE1","type":"bytes25"},{"internalType":"bytes24","name":"_TLE2","type":"bytes24"}],"name":"setTLE","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"withdrawFunds","outputs":[],"stateMutability":"nonpayable","type":"function"}]


//[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]



// Smart contract EVM bytecode as hex

let code = '0x' + "608060405234801561001057600080fd5b5061341a806100206000396000f3fe6080604052600436106100f35760003560e01c80638656bbe91161008a578063b14b678711610059578063b14b678714610330578063ca90fee514610359578063e3752bbe14610397578063ed957100146103d4576100f3565b80638656bbe91461026457806392a0294f1461028d578063a5c1674e146102ca578063ac231a9814610307576100f3565b80633e24e56a116100c65780633e24e56a146101a557806342dd519c146101c157806371944180146101fe5780637d918a2514610227576100f3565b806307bbb8d4146100f8578063155dd5ee1461011457806320a6bde91461013d57806323bf426214610166575b600080fd5b610112600480360381019061010d9190612b32565b610411565b005b34801561012057600080fd5b5061013b60048036038101906101369190612aba565b61071d565b005b34801561014957600080fd5b50610164600480360381019061015f9190612b32565b6108e3565b005b34801561017257600080fd5b5061018d60048036038101906101889190612be9565b610a64565b60405161019c93929190612fb8565b60405180910390f35b6101bf60048036038101906101ba9190612c25565b610b5a565b005b3480156101cd57600080fd5b506101e860048036038101906101e39190612aba565b610ee0565b6040516101f59190612f0e565b60405180910390f35b34801561020a57600080fd5b5061022560048036038101906102209190612b6e565b611004565b005b34801561023357600080fd5b5061024e60048036038101906102499190612aba565b611248565b60405161025b9190612ff6565b60405180910390f35b34801561027057600080fd5b5061028b60048036038101906102869190612b32565b61128d565b005b34801561029957600080fd5b506102b460048036038101906102af9190612aba565b61139d565b6040516102c19190612f4b565b60405180910390f35b3480156102d657600080fd5b506102f160048036038101906102ec9190612aba565b61146b565b6040516102fe9190612f30565b60405180910390f35b34801561031357600080fd5b5061032e60048036038101906103299190612ae3565b61190d565b005b34801561033c57600080fd5b5061035760048036038101906103529190612ae3565b611b8e565b005b34801561036557600080fd5b50610380600480360381019061037b9190612aba565b611c65565b60405161038e929190612f66565b60405180910390f35b3480156103a357600080fd5b506103be60048036038101906103b99190612aba565b61210e565b6040516103cb9190612f0e565b60405180910390f35b3480156103e057600080fd5b506103fb60048036038101906103f69190612aba565b61236e565b6040516104089190613011565b60405180910390f35b816000801b6000828154811061042357fe5b90600052602060002090600d0201600401541461043f57600080fd5b6000818154811061044c57fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff1667ffffffffffffffff16421061048757600080fd5b60006104928261236e565b9050803410156104a157600080fd5b600082815481106104ae57fe5b90600052602060002090600d0201600001543411156104cc57600080fd5b60001515600085815481106104dd57fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461054557600080fd5b6000848154811061055257fe5b90600052602060002090600d0201600701339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600085815481106105d357fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550346000858154811061064657fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555034600085815481106106a657fe5b90600052602060002090600d0201600201600082825401925050819055503373ffffffffffffffffffffffffffffffffffffffff16847f4059ccbea539583e69b0db8efe5c16d1c5ddc863b12df52b3be3fa65029d8a6334864260405161070f9392919061302c565b60405180910390a350505050565b806000818154811061072b57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461079457600080fd5b601e600083815481106107a357fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff160167ffffffffffffffff1642116107df57600080fd5b6000801b600083815481106107f057fe5b90600052602060002090600d020160040154141561080d57600080fd5b600080838154811061081b57fe5b90600052602060002090600d0201600201549050600080848154811061083d57fe5b90600052602060002090600d0201600201819055506000811161085f57600080fd5b3373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050501580156108a5573d6000803e3d6000fd5b50827f5ab32616397610e8c52d9f2c536a03778db8878dda9c977d99c05bcb5666dd90826040516108d69190613011565b60405180910390a2505050565b8160008082815481106108f257fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541161094b57600080fd5b6000801b6000848154811061095c57fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541415610a105781600084815481106109bf57fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002050505b3373ffffffffffffffffffffffffffffffffffffffff16837fc9a5303ca56727b24e4955597b9bb74dd9bc6462dbad79d63dd393b1b7e5d10684604051610a579190612f4b565b60405180910390a3505050565b60016020528160005260406000208181548110610a7d57fe5b906000526020600020906003020160009150915050806000018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b2a5780601f10610aff57610100808354040283529160200191610b2a565b820191906000526020600020905b815481529060010190602001808311610b0d57829003601f168201915b5050505050908060010160009054906101000a900460381b908060020160009054906101000a900460381b905083565b610b6261275c565b868160000181815250503481602001818152505034816040018181525050858160a0019067ffffffffffffffff16908167ffffffffffffffff16815250508281610120019060ff16908160ff1681525050428160e0019067ffffffffffffffff16908167ffffffffffffffff168152505042850181610100019067ffffffffffffffff16908167ffffffffffffffff16815250504267ffffffffffffffff1681610100015167ffffffffffffffff1611610c1b57600080fd5b33816060019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505060008190806001815401808255809150506001900390600052602060002090600d020160009091909190915060008201518160000155602082015181600101556040820151816002015560608201518160030160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506080820151816004015560a08201518160050160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060c08201518160050160086101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060e08201518160050160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506101008201518160050160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506101208201518160060160006101000a81548160ff021916908360ff160217905550610140820151816007019080519060200190610dea92919061282c565b5061016082015181600a0160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555061018082015181600a0160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050503373ffffffffffffffffffffffffffffffffffffffff166001600080549050037fc1fe646c8e19f25897b021414c652720d8350cd9d63596199ee8dc136fdcd76489348a428761010001518b8b8b604051610ecf98979695949392919061308c565b60405180910390a350505050505050565b60608160008181548110610ef057fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610f5957600080fd5b60008381548110610f6657fe5b90600052602060002090600d0201600701805480602002602001604051908101604052809291908181526020018280548015610ff757602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311610fad575b5050505050915050919050565b836000818154811061101257fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461107b57600080fd5b6110836128b6565b84816000018190525083816020019066ffffffffffffff1916908166ffffffffffffff1916815250508267ffffffffffffffff1916816040019066ffffffffffffff1916908166ffffffffffffff1916815250506001600087815260200190815260200160002081908060018154018082558091505060019003906000526020600020906003020160009091909190915060008201518160000190805190602001906111309291906128eb565b5060208201518160010160006101000a81548178ffffffffffffffffffffffffffffffffffffffffffffffffff021916908360381c021790555060408201518160020160006101000a81548178ffffffffffffffffffffffffffffffffffffffffffffffffff021916908360381c02179055505050600086815481106111b257fe5b90600052602060002090600d0201600501600881819054906101000a900467ffffffffffffffff168092919060010191906101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555050857f0d24b8ac995fa8eca2b46e0246413d6123831e152dfb6a0cbd71df864ba2192b866040516112389190612f96565b60405180910390a2505050505050565b600080828154811061125657fe5b90600052602060002090600d020160050160089054906101000a900467ffffffffffffffff1667ffffffffffffffff169050919050565b816000818154811061129b57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461130457600080fd5b6000801b6000848154811061131557fe5b90600052602060002090600d02016004015414801561133757506000801b8214155b1561139857816000848154811061134a57fe5b90600052602060002090600d020160040181905550827f2a1b289fe6fe9bd89c1cfbbed506798801b402cafb0a3d93c29cb9c8aafed9208360405161138f9190612f4b565b60405180910390a25b505050565b60008160008082815481106113ae57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541161140757600080fd5b6000838154811061141457fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054915050919050565b600081600080828154811061147c57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054116114d557600080fd5b60008084815481106114e357fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050806000858154811061154257fe5b90600052602060002090600d020160020154101561155f57600080fd5b6000801b6000858154811061157057fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414156115d9576115cf848261258e565b6001925050611907565b6000801b600085815481106115ea57fe5b90600052602060002090600d020160040154146118a857600080858154811061160f57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546000868154811061166b57fe5b90600052602060002090600d0201600401541890506000858154811061168d57fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054816040516020016116ed9190612f4b565b6040516020818303038152906040528051906020012014611795576000858154811061171557fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166000868154811061176257fe5b90600052602060002090600d0201600101548161177b57fe5b048201915061178a858361258e565b600193505050611907565b600085815481106117a257fe5b90600052602060002090600d020160050160009054906101000a900467ffffffffffffffff1667ffffffffffffffff16600086815481106117df57fe5b90600052602060002090600d020160050160089054906101000a900467ffffffffffffffff1667ffffffffffffffff1610156118a2576000858154811061182257fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166000868154811061186f57fe5b90600052602060002090600d0201600101548161188857fe5b0482019150611897858361258e565b600193505050611907565b50611901565b600084815481106118b557fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff1667ffffffffffffffff16421115611900576118f6848261258e565b6001925050611907565b5b60009250505b50919050565b826000818154811061191b57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461198457600080fd5b600080858154811061199257fe5b90600052602060002090600d020160080160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541115611b88576000801b600085815481106119f857fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054148015611a5757506000801b8214155b15611b87578160008581548110611a6a57fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555060008481548110611ac957fe5b90600052602060002090600d0201600a01601081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550508273ffffffffffffffffffffffffffffffffffffffff16847f557b07a87337236272a12c29e39bd292a192d7c1811cc6994635d23284e935df84604051611b7e9190612f4b565b60405180910390a35b5b50505050565b8260008181548110611b9c57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611c0557600080fd5b6000801b8214611c5f578273ffffffffffffffffffffffffffffffffffffffff16847fd57e7ea23bb50dbe8316bec30809240f566976ab1b1e4e37e76c7bb3e0b645f084604051611c569190612f4b565b60405180910390a35b50505050565b6000606060008381548110611c7657fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff1667ffffffffffffffff1642108015611cd457506000801b60008481548110611cc057fe5b90600052602060002090600d020160040154145b15611f81576000801b60008481548110611cea57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141580611daf575060008381548110611d4e57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b611db857600080fd5b60008381548110611dc557fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546001600085815260200190815260200160002080805480602002602001604051908101604052809291908181526020016000905b82821015611f725783829060005260206000209060030201604051806060016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611f045780601f10611ed957610100808354040283529160200191611f04565b820191906000526020600020905b815481529060010190602001808311611ee757829003601f168201915b505050505081526020016001820160009054906101000a900460381b66ffffffffffffff191666ffffffffffffff191681526020016002820160009054906101000a900460381b66ffffffffffffff191666ffffffffffffff19168152505081526020019060010190611e48565b50505050905091509150612109565b60008381548110611f8e57fe5b90600052602060002090600d0201600401546001600085815260200190815260200160002080805480602002602001604051908101604052809291908181526020016000905b828210156120fe5783829060005260206000209060030201604051806060016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156120905780601f1061206557610100808354040283529160200191612090565b820191906000526020600020905b81548152906001019060200180831161207357829003601f168201915b505050505081526020016001820160009054906101000a900460381b66ffffffffffffff191666ffffffffffffff191681526020016002820160009054906101000a900460381b66ffffffffffffff191666ffffffffffffff19168152505081526020019060010190611fd4565b505050509050915091505b915091565b6060816000818154811061211e57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461218757600080fd5b600080848154811061219557fe5b90600052602060002090600d0201600a0160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16905060608167ffffffffffffffff811180156121f057600080fd5b5060405190808252806020026020018201604052801561221f5781602001602082028036833780820191505090505b509050600080600090505b6000878154811061223757fe5b90600052602060002090600d020160070180549050811015612361576000878154811061226057fe5b90600052602060002090600d0201600701818154811061227c57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915060008088815481106122b757fe5b90600052602060002090600d020160080160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541415612354578183828151811061231957fe5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505b808060010191505061222a565b5081945050505050919050565b6000806000838154811061237e57fe5b90600052602060002090600d020160000154905060008084815481106123a057fe5b90600052602060002090600d020160060160009054906101000a900460ff16905060018160ff16141561249a5760008085815481106123db57fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff166000868154811061240e57fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff160367ffffffffffffffff169050600080868154811061244f57fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff1667ffffffffffffffff1642039050818185028161248e57fe5b04840393505050612584565b60028160ff1614156125835760008085815481106124b457fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff16600086815481106124e757fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff160367ffffffffffffffff169050600080868154811061252857fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff1667ffffffffffffffff164203905083828286600202028161256b57fe5b0483840283848802028161257b57fe5b040301935050505b5b8192505050919050565b806000838154811061259c57fe5b90600052602060002090600d02016002015410156125b957600080fd5b600082815481106125c657fe5b90600052602060002090600d0201600a01600081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050600080838154811061264257fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555080600083815481106126a257fe5b90600052602060002090600d0201600201600082825403925050819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015612706573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff16827f54cd3e4964cbbb07875e24bd38c626e4572701f70d0992629dfbad3a0a6597ec8342604051612750929190613063565b60405180910390a35050565b604051806101a00160405280600081526020016000815260200160008152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160008019168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff168152602001600060ff1681526020016060815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff1681525090565b8280548282559060005260206000209081019282156128a5579160200282015b828111156128a45782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055509160200191906001019061284c565b5b5090506128b2919061296b565b5090565b604051806060016040528060608152602001600066ffffffffffffff19168152602001600066ffffffffffffff191681525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061292c57805160ff191683800117855561295a565b8280016001018555821561295a579182015b8281111561295957825182559160200191906001019061293e565b5b50905061296791906129ae565b5090565b6129ab91905b808211156129a757600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905550600101612971565b5090565b90565b6129d091905b808211156129cc5760008160009055506001016129b4565b5090565b90565b6000813590506129e281613343565b92915050565b6000813590506129f78161335a565b92915050565b600081359050612a0c81613371565b92915050565b600081359050612a2181613388565b92915050565b600082601f830112612a3857600080fd5b8135612a4b612a468261313e565b613111565b91508082526020830160208301858383011115612a6757600080fd5b612a728382846132f0565b50505092915050565b600081359050612a8a8161339f565b92915050565b600081359050612a9f816133b6565b92915050565b600081359050612ab4816133cd565b92915050565b600060208284031215612acc57600080fd5b6000612ada84828501612a7b565b91505092915050565b600080600060608486031215612af857600080fd5b6000612b0686828701612a7b565b9350506020612b17868287016129d3565b9250506040612b2886828701612a12565b9150509250925092565b60008060408385031215612b4557600080fd5b6000612b5385828601612a7b565b9250506020612b6485828601612a12565b9150509250929050565b60008060008060808587031215612b8457600080fd5b6000612b9287828801612a7b565b945050602085013567ffffffffffffffff811115612baf57600080fd5b612bbb87828801612a27565b9350506040612bcc878288016129fd565b9250506060612bdd878288016129e8565b91505092959194509250565b60008060408385031215612bfc57600080fd5b6000612c0a85828601612a7b565b9250506020612c1b85828601612a7b565b9150509250929050565b60008060008060008060c08789031215612c3e57600080fd5b6000612c4c89828a01612a7b565b9650506020612c5d89828a01612a90565b9550506040612c6e89828a01612a90565b9450506060612c7f89828a01612a12565b9350506080612c9089828a01612aa5565b92505060a087013567ffffffffffffffff811115612cad57600080fd5b612cb989828a01612a27565b9150509295509295509295565b6000612cd28383612cf2565b60208301905092915050565b6000612cea8383612e82565b905092915050565b612cfb81613209565b82525050565b6000612d0c8261318a565b612d1681856131c5565b9350612d218361316a565b8060005b83811015612d52578151612d398882612cc6565b9750612d44836131ab565b925050600181019050612d25565b5085935050505092915050565b6000612d6a82613195565b612d7481856131d6565b935083602082028501612d868561317a565b8060005b85811015612dc25784840389528151612da38582612cde565b9450612dae836131b8565b925060208a01995050600181019050612d8a565b50829750879550505050505092915050565b612ddd8161321b565b82525050565b612dec81613253565b82525050565b612dfb81613253565b82525050565b612e0a8161327f565b82525050565b6000612e1b826131a0565b612e2581856131e7565b9350612e358185602086016132ff565b612e3e81613332565b840191505092915050565b6000612e54826131a0565b612e5e81856131f8565b9350612e6e8185602086016132ff565b612e7781613332565b840191505092915050565b60006060830160008301518482036000860152612e9f8282612e10565b9150506020830151612eb46020860182612de3565b506040830151612ec76040860182612de3565b508091505092915050565b612edb81613289565b82525050565b612eea816132c5565b82525050565b612ef9816132cf565b82525050565b612f08816132e3565b82525050565b60006020820190508181036000830152612f288184612d01565b905092915050565b6000602082019050612f456000830184612dd4565b92915050565b6000602082019050612f606000830184612e01565b92915050565b6000604082019050612f7b6000830185612e01565b8181036020830152612f8d8184612d5f565b90509392505050565b60006020820190508181036000830152612fb08184612e49565b905092915050565b60006060820190508181036000830152612fd28186612e49565b9050612fe16020830185612df2565b612fee6040830184612df2565b949350505050565b600060208201905061300b6000830184612ed2565b92915050565b60006020820190506130266000830184612ee1565b92915050565b60006060820190506130416000830186612ee1565b61304e6020830185612e01565b61305b6040830184612ee1565b949350505050565b60006040820190506130786000830185612ee1565b6130856020830184612ee1565b9392505050565b6000610100820190506130a2600083018b612ee1565b6130af602083018a612ee1565b6130bc6040830189612ef0565b6130c96060830188612ef0565b6130d66080830187612ef0565b6130e360a0830186612e01565b6130f060c0830185612eff565b81810360e08301526131028184612e49565b90509998505050505050505050565b6000604051905081810181811067ffffffffffffffff8211171561313457600080fd5b8060405250919050565b600067ffffffffffffffff82111561315557600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b6000613214826132a5565b9050919050565b60008115159050919050565b60007fffffffffffffffffffffffffffffffffffffffffffffffff000000000000000082169050919050565b60007fffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000082169050919050565b6000819050919050565b60006fffffffffffffffffffffffffffffffff82169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600067ffffffffffffffff82169050919050565b600060ff82169050919050565b82818337600083830152505050565b60005b8381101561331d578082015181840152602081019050613302565b8381111561332c576000848401525b50505050565b6000601f19601f8301169050919050565b61334c81613209565b811461335757600080fd5b50565b61336381613227565b811461336e57600080fd5b50565b61337a81613253565b811461338557600080fd5b50565b6133918161327f565b811461339c57600080fd5b50565b6133a8816132c5565b81146133b357600080fd5b50565b6133bf816132cf565b81146133ca57600080fd5b50565b6133d6816132e3565b81146133e157600080fd5b5056fea264697066735822122096c547fa677914bae156b8631776153cfc0af1cd6a53dafdf485784c28899a6364736f6c63430006080033";



//
// Create Contract proxy class
let SampleContract = new web3.eth.Contract(abi);
const gasPrice = 1000;//web3.eth.gasPrice;
const gasPriceHex = web3.utils.numberToHex(gasPrice);
const gasLimitHex = web3.utils.numberToHex(4500000);


(async () => {
    const nonceval = await web3.eth.getTransactionCount(account1, "pending"); //'0x' + new Date().getTime();

    console.log(nonceval);

    var fTx = {
        nonce: nonceval,
        gasPrice: gasPriceHex,
        gasLimit: gasLimitHex,
        data: code,
        from: account1
    };

    var txx = new Tx(fTx);
    txx.sign(key1);

    var sTx =txx.serialize();


    const receipt = await web3.eth.sendSignedTransaction('0x' + sTx.toString('hex')).on('receipt', function(receipt){
        console.log(receipt);
    });
})();
