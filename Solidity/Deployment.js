const Web3 = require('web3');
var Tx = require('ethereumjs-tx');
let fs = require("fs");



// Web3 Initialisation
const provider = 'http://192.168.33.115:8545';
console.log("******************************************");
console.log("Using provider : " + provider);
console.log("******************************************");
var web3 = new Web3(new Web3.providers.HttpProvider(provider))


//////////////////////////////////////Account info for deployment///////////////////////////////////////////////////
var account1= "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73";
var key1 =new Buffer.from('8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63','hex');
/////////////////////////////////////////////////////////////////////////////////////////:

// Read the compiled contract code
// Compile with
// solc SampleContract.sol --combined-json abi,asm,ast,bin,bin-runtime,clone-bin,devdoc,interface,opcodes,srcmap,srcmap-runtime,userdoc > contracts.json
// let source = fs.readFileSync("/home/rsx14/IdeaProjects/PIR/Solidity/contracts.json");
// let contracts = JSON.parse(source)["contracts"];

// ABI description as JSON structure
let abi = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"fund","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"}],"name":"NewClient","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"provider","type":"address"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"redeemFunds","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"minimumData","type":"uint128"},{"indexed":false,"internalType":"uint128","name":"deployTime","type":"uint128"},{"indexed":false,"internalType":"uint128","name":"endTime","type":"uint128"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint8","name":"depreciationType","type":"uint8"},{"indexed":false,"internalType":"string","name":"description","type":"string"}],"name":"NewDataReference","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encryptedEncodedKey","type":"bytes32"}],"name":"encryptedEncodedKeyEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encryptedKeyHash","type":"bytes32"}],"name":"encryptedKeyHash","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"keyDecoder","type":"uint256"}],"name":"keyDecoder","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"string","name":"TLE","type":"string"}],"name":"newTLE","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"referenceKey","type":"uint256"}],"name":"referenceKey","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"funds","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"withdrawRefund","type":"event"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"TLEs","outputs":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"string","name":"TLE","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"}],"name":"buyReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_price","type":"uint256"},{"internalType":"uint128","name":"_minimumData","type":"uint128"},{"internalType":"uint128","name":"_referenceDuration","type":"uint128"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"},{"internalType":"uint8","name":"_depreciationType","type":"uint8"},{"internalType":"string","name":"_description","type":"string"}],"name":"createDataReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"dataReferences","outputs":[{"internalType":"uint256","name":"initialPrice","type":"uint256"},{"internalType":"uint256","name":"redeemFunds","type":"uint256"},{"internalType":"uint256","name":"referenceKey","type":"uint256"},{"internalType":"uint128","name":"minimumData","type":"uint128"},{"internalType":"uint128","name":"numberOfData","type":"uint128"},{"internalType":"uint128","name":"deployTime","type":"uint128"},{"internalType":"uint128","name":"endTime","type":"uint128"},{"internalType":"uint8","name":"depreciationType","type":"uint8"},{"internalType":"address","name":"provider","type":"address"},{"internalType":"uint256","name":"withdrawableFunds","type":"uint256"},{"internalType":"uint128","name":"numberOfDisputes","type":"uint128"},{"internalType":"uint128","name":"completedClients","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClientDisputes","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClients","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getNumberOfData","outputs":[{"internalType":"uint128","name":"numberOfData","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getReferenceCurrentPrice","outputs":[{"internalType":"uint256","name":"price","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getTLEs","outputs":[{"components":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"string","name":"TLE","type":"string"}],"internalType":"struct TLE_Contract.structTLE[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"raiseDispute","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_encryptedEncodedKey","type":"bytes32"}],"name":"setEncryptedEncodedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_encryptedKeyHash","type":"bytes32"}],"name":"setEncryptedHashedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"uint256","name":"_keyDecoder","type":"uint256"}],"name":"setKeyDecoder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"uint256","name":"_referenceKey","type":"uint256"}],"name":"setReferenceKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"string","name":"_spaceObject","type":"string"},{"internalType":"string","name":"_TLE","type":"string"}],"name":"setTLE","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"withdrawFunds","outputs":[],"stateMutability":"nonpayable","type":"function"}];

//[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]



// Smart contract EVM bytecode as hex
let code = '0x' + "60806040526000805566470de4df82000060025534801561001f57600080fd5b506132f18061002f6000396000f3fe6080604052600436106100f35760003560e01c80637a5087fb1161008a578063b14b678711610059578063b14b678714610326578063ca90fee51461034f578063e3752bbe1461038c578063ed957100146103c9576100f3565b80637a5087fb1461027b5780637d918a2514610297578063a5c1674e146102d4578063b07a3b66146102fd576100f3565b8063293dca69116100c6578063293dca69146101a457806342dd519c146101cd57806370f383141461020a578063718524ac14610252576100f3565b806307bbb8d4146100f85780630d222dea14610114578063155dd5ee1461013d57806323bf426214610166575b600080fd5b610112600480360381019061010d9190612a08565b610406565b005b34801561012057600080fd5b5061013b600480360381019061013691906129b9565b61072f565b005b34801561014957600080fd5b50610164600480360381019061015f9190612941565b6109a0565b005b34801561017257600080fd5b5061018d60048036038101906101889190612b64565b610b33565b60405161019b929190612e70565b60405180910390f35b3480156101b057600080fd5b506101cb60048036038101906101c69190612a44565b610ca1565b005b3480156101d957600080fd5b506101f460048036038101906101ef9190612941565b610e65565b6040516102019190612def565b60405180910390f35b34801561021657600080fd5b50610231600480360381019061022c9190612941565b610f89565b6040516102499c9b9a99989796959493929190612fd4565b60405180910390f35b34801561025e57600080fd5b5061027960048036038101906102749190612a08565b6110cb565b005b61029560048036038101906102909190612ac3565b61125e565b005b3480156102a357600080fd5b506102be60048036038101906102b99190612941565b611661565b6040516102cb9190612ec7565b60405180910390f35b3480156102e057600080fd5b506102fb60048036038101906102f69190612941565b6116a5565b005b34801561030957600080fd5b50610324600480360381019061031f9190612b64565b611b8f565b005b34801561033257600080fd5b5061034d6004803603810190610348919061296a565b611c8e565b005b34801561035b57600080fd5b5061037660048036038101906103719190612941565b611d5a565b6040516103839190612e11565b60405180910390f35b34801561039857600080fd5b506103b360048036038101906103ae9190612941565b611f10565b6040516103c09190612def565b60405180910390f35b3480156103d557600080fd5b506103f060048036038101906103eb9190612941565b612172565b6040516103fd9190612ee2565b60405180910390f35b8160006001828154811061041657fe5b90600052602060002090600d0201600201541461043257600080fd5b6001818154811061043f57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16421061048a57600080fd5b600061049582612172565b9050803410156104a457600080fd5b600182815481106104b157fe5b90600052602060002090600d0201600001543411156104cf57600080fd5b6001805490508411156104e157600080fd5b60001515600185815481106104f257fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461055a57600080fd5b6001848154811061056757fe5b90600052602060002090600d0201600701339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060018085815481106105e757fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550346001858154811061065a57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555034600185815481106106ba57fe5b90600052602060002090600d0201600601600082825401925050819055503373ffffffffffffffffffffffffffffffffffffffff16847fef284047b82f7c7b42032946386a3f8dfd2d4e7c74f9d59242e374620a1e8a523486604051610721929190612efd565b60405180910390a350505050565b826001818154811061073d57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146107a657600080fd5b6000600185815481106107b557fe5b90600052602060002090600d020160080160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054111561099a5760006001858154811061081957fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141561099957816001858154811061087c57fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550600184815481106108db57fe5b90600052602060002090600d0201600a01601081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550508273ffffffffffffffffffffffffffffffffffffffff16847f18867905c35c77de44f5c248899c39aefcc43144782339e6d2233112022ed884846040516109909190612ee2565b60405180910390a35b5b50505050565b80600181815481106109ae57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610a1757600080fd5b6206978060018381548110610a2857fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16016fffffffffffffffffffffffffffffffff164211610a7457600080fd5b600060018381548110610a8357fe5b90600052602060002090600d0201600201541415610aa057600080fd5b600060018381548110610aaf57fe5b90600052602060002090600d0201600601549050600060018481548110610ad257fe5b90600052602060002090600d0201600601819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015610b2d573d6000803e3d6000fd5b50505050565b60036020528160005260406000208181548110610b4c57fe5b906000526020600020906002020160009150915050806000018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610bf95780601f10610bce57610100808354040283529160200191610bf9565b820191906000526020600020905b815481529060010190602001808311610bdc57829003601f168201915b505050505090806001018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c975780601f10610c6c57610100808354040283529160200191610c97565b820191906000526020600020905b815481529060010190602001808311610c7a57829003601f168201915b5050505050905082565b8260018181548110610caf57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610d1857600080fd5b610d2061260b565b838160000181905250828160200181905250600360008681526020019081526020016000208190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000019080519060200190610d8b929190612625565b506020820151816001019080519060200190610da8929190612625565b50505060018581548110610db857fe5b90600052602060002090600d0201600301601081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050847f0d24b8ac995fa8eca2b46e0246413d6123831e152dfb6a0cbd71df864ba2192b85604051610e569190612e4e565b60405180910390a25050505050565b60608160018181548110610e7557fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610ede57600080fd5b60018381548110610eeb57fe5b90600052602060002090600d0201600701805480602002602001604051908101604052809291908181526020018280548015610f7c57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311610f32575b5050505050915050919050565b60018181548110610f9657fe5b90600052602060002090600d02016000915090508060000154908060010154908060020154908060030160009054906101000a90046fffffffffffffffffffffffffffffffff16908060030160109054906101000a90046fffffffffffffffffffffffffffffffff16908060040160009054906101000a90046fffffffffffffffffffffffffffffffff16908060040160109054906101000a90046fffffffffffffffffffffffffffffffff16908060050160009054906101000a900460ff16908060050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff169080600601549080600a0160009054906101000a90046fffffffffffffffffffffffffffffffff169080600a0160109054906101000a90046fffffffffffffffffffffffffffffffff1690508c565b8160011515600182815481106110dd57fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461114557600080fd5b6000801b6001848154811061115657fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141561120a5781600184815481106111b957fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002050505b3373ffffffffffffffffffffffffffffffffffffffff16837f8a8e57e77f82d72176351fb8deea0f031046ad9629b15591a67e542e70317661846040516112519190612e33565b60405180910390a3505050565b6112666126a5565b868160000181815250503481602001818152505034816101200181815250508581606001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff1681525050828160e0019060ff16908160ff1681525050428160a001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff16815250504285018160c001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff1681525050426fffffffffffffffffffffffffffffffff168160c001516fffffffffffffffffffffffffffffffff161161135d57600080fd5b3381610100019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505060018190806001815401808255809150506001900390600052602060002090600d020160009091909190915060008201518160000155602082015181600101556040820151816002015560608201518160030160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060808201518160030160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060a08201518160040160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060c08201518160040160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060e08201518160050160006101000a81548160ff021916908360ff1602179055506101008201518160050160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610120820151816006015561014082015181600701908051906020019061156d929190612792565b5061016082015181600a0160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555061018082015181600a0160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050503373ffffffffffffffffffffffffffffffffffffffff1660018080549050037f87df291311b02f282c5dcfc847fe75d49b00eded0dff5c3b8a5e9110ccca8e2e89348a428760c001518b8b8b604051611650989796959493929190612f4f565b60405180910390a350505050505050565b60006001828154811061167057fe5b90600052602060002090600d020160030160109054906101000a90046fffffffffffffffffffffffffffffffff169050919050565b8060011515600182815481106116b757fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461171f57600080fd5b60006001838154811061172e57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490506000811161178c57600080fd5b806001848154811061179a57fe5b90600052602060002090600d02016006015410156117b757600080fd5b6000600184815481106117c657fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141561182a5761182583826123e7565b611b8a565b60006001848154811061183957fe5b90600052602060002090600d02016002015414611b295760006001848154811061185f57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054600185815481106118bb57fe5b90600052602060002090600d020160020154189050600184815481106118dd57fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548160405160200161193d9190612ee2565b60405160208183030381529060405280519060200120146119ef576119de6001858154811061196857fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16600186815481106119b557fe5b90600052602060002090600d020160010154816119ce57fe5b04836125b690919063ffffffff16565b91506119ea84836123e7565b611b23565b600184815481106119fc57fe5b90600052602060002090600d020160030160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1660018581548110611a4957fe5b90600052602060002090600d020160030160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161015611b2257611b1560018581548110611a9f57fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1660018681548110611aec57fe5b90600052602060002090600d02016001015481611b0557fe5b04836125b690919063ffffffff16565b9150611b2184836123e7565b5b5b50611b89565b60018381548110611b3657fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16421115611b8857611b8783826123e7565b5b5b5b505050565b8160018181548110611b9d57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611c0657600080fd5b600060018481548110611c1557fe5b90600052602060002090600d0201600201541415611c89578160018481548110611c3b57fe5b90600052602060002090600d020160020181905550827fe8c4ae2657e816301c69b1eca56ae2e769762e8e6a8fb457b876b0a6228bbc2c83604051611c809190612ee2565b60405180910390a25b505050565b8260018181548110611c9c57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611d0557600080fd5b8273ffffffffffffffffffffffffffffffffffffffff16847fd57e7ea23bb50dbe8316bec30809240f566976ab1b1e4e37e76c7bb3e0b645f084604051611d4c9190612e33565b60405180910390a350505050565b606060036000838152602001908152602001600020805480602002602001604051908101604052809291908181526020016000905b82821015611f055783829060005260206000209060020201604051806040016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611e4b5780601f10611e2057610100808354040283529160200191611e4b565b820191906000526020600020905b815481529060010190602001808311611e2e57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611eed5780601f10611ec257610100808354040283529160200191611eed565b820191906000526020600020905b815481529060010190602001808311611ed057829003601f168201915b50505050508152505081526020019060010190611d8f565b505050509050919050565b60608160018181548110611f2057fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611f8957600080fd5b600060018481548110611f9857fe5b90600052602060002090600d0201600a0160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16905060608167ffffffffffffffff81118015611ff357600080fd5b506040519080825280602002602001820160405280156120225781602001602082028036833780820191505090505b509050600080600090505b6001878154811061203a57fe5b90600052602060002090600d020160070180549050811015612165576001878154811061206357fe5b90600052602060002090600d0201600701818154811061207f57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1691506000600188815481106120bb57fe5b90600052602060002090600d020160080160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541415612158578183828151811061211d57fe5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505b808060010191505061202d565b5081945050505050919050565b6000806001838154811061218257fe5b90600052602060002090600d02016000015490506000600184815481106121a557fe5b90600052602060002090600d020160050160009054906101000a900460ff16905060018160ff1614156122c9576000600185815481106121e157fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166001868154811061221c57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16036fffffffffffffffffffffffffffffffff16905060006001868154811061226e57fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff164203905081818502816122bd57fe5b048403935050506123dd565b60028160ff1614156123dc576000600185815481106122e457fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166001868154811061231f57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16036fffffffffffffffffffffffffffffffff16905060006001868154811061237157fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16420390508382828660020202816123c457fe5b048384028384880202816123d457fe5b040301935050505b5b8192505050919050565b80600183815481106123f557fe5b90600052602060002090600d020160060154101561241257600080fd5b6001828154811061241f57fe5b90600052602060002090600d0201600a01600081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505060006001838154811061249c57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555080600183815481106124fc57fe5b90600052602060002090600d0201600601600082825403925050819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015612560573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff16827f54cd3e4964cbbb07875e24bd38c626e4572701f70d0992629dfbad3a0a6597ec83426040516125aa929190612f26565b60405180910390a35050565b600080828401905083811015612601576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016125f890612ea7565b60405180910390fd5b8091505092915050565b604051806040016040528060608152602001606081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061266657805160ff1916838001178555612694565b82800160010185558215612694579182015b82811115612693578251825591602001919060010190612678565b5b5090506126a1919061281c565b5090565b604051806101a0016040528060008152602001600081526020016000815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff168152602001600060ff168152602001600073ffffffffffffffffffffffffffffffffffffffff168152602001600081526020016060815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff1681525090565b82805482825590600052602060002090810192821561280b579160200282015b8281111561280a5782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550916020019190600101906127b2565b5b5090506128189190612841565b5090565b61283e91905b8082111561283a576000816000905550600101612822565b5090565b90565b61288191905b8082111561287d57600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905550600101612847565b5090565b90565b60008135905061289381613248565b92915050565b6000813590506128a88161325f565b92915050565b600082601f8301126128bf57600080fd5b81356128d26128cd826130bb565b61308e565b915080825260208301602083018583830111156128ee57600080fd5b6128f98382846131f5565b50505092915050565b60008135905061291181613276565b92915050565b6000813590506129268161328d565b92915050565b60008135905061293b816132a4565b92915050565b60006020828403121561295357600080fd5b600061296184828501612917565b91505092915050565b60008060006060848603121561297f57600080fd5b600061298d86828701612917565b935050602061299e86828701612884565b92505060406129af86828701612899565b9150509250925092565b6000806000606084860312156129ce57600080fd5b60006129dc86828701612917565b93505060206129ed86828701612884565b92505060406129fe86828701612917565b9150509250925092565b60008060408385031215612a1b57600080fd5b6000612a2985828601612917565b9250506020612a3a85828601612899565b9150509250929050565b600080600060608486031215612a5957600080fd5b6000612a6786828701612917565b935050602084013567ffffffffffffffff811115612a8457600080fd5b612a90868287016128ae565b925050604084013567ffffffffffffffff811115612aad57600080fd5b612ab9868287016128ae565b9150509250925092565b60008060008060008060c08789031215612adc57600080fd5b6000612aea89828a01612917565b9650506020612afb89828a01612902565b9550506040612b0c89828a01612902565b9450506060612b1d89828a01612899565b9350506080612b2e89828a0161292c565b92505060a087013567ffffffffffffffff811115612b4b57600080fd5b612b5789828a016128ae565b9150509295509295509295565b60008060408385031215612b7757600080fd5b6000612b8585828601612917565b9250506020612b9685828601612917565b9150509250929050565b6000612bac8383612bcc565b60208301905092915050565b6000612bc48383612d7e565b905092915050565b612bd581613186565b82525050565b612be481613186565b82525050565b6000612bf582613107565b612bff8185613142565b9350612c0a836130e7565b8060005b83811015612c3b578151612c228882612ba0565b9750612c2d83613128565b925050600181019050612c0e565b5085935050505092915050565b6000612c5382613112565b612c5d8185613153565b935083602082028501612c6f856130f7565b8060005b85811015612cab5784840389528151612c8c8582612bb8565b9450612c9783613135565b925060208a01995050600181019050612c73565b50829750879550505050505092915050565b612cc681613198565b82525050565b6000612cd78261311d565b612ce18185613164565b9350612cf1818560208601613204565b612cfa81613237565b840191505092915050565b6000612d108261311d565b612d1a8185613175565b9350612d2a818560208601613204565b612d3381613237565b840191505092915050565b6000612d4b601b83613175565b91507f536166654d6174683a206164646974696f6e206f766572666c6f7700000000006000830152602082019050919050565b60006040830160008301518482036000860152612d9b8282612ccc565b91505060208301518482036020860152612db58282612ccc565b9150508091505092915050565b612dcb816131a2565b82525050565b612dda816131de565b82525050565b612de9816131e8565b82525050565b60006020820190508181036000830152612e098184612bea565b905092915050565b60006020820190508181036000830152612e2b8184612c48565b905092915050565b6000602082019050612e486000830184612cbd565b92915050565b60006020820190508181036000830152612e688184612d05565b905092915050565b60006040820190508181036000830152612e8a8185612d05565b90508181036020830152612e9e8184612d05565b90509392505050565b60006020820190508181036000830152612ec081612d3e565b9050919050565b6000602082019050612edc6000830184612dc2565b92915050565b6000602082019050612ef76000830184612dd1565b92915050565b6000604082019050612f126000830185612dd1565b612f1f6020830184612cbd565b9392505050565b6000604082019050612f3b6000830185612dd1565b612f486020830184612dd1565b9392505050565b600061010082019050612f65600083018b612dd1565b612f72602083018a612dd1565b612f7f6040830189612dc2565b612f8c6060830188612dc2565b612f996080830187612dc2565b612fa660a0830186612cbd565b612fb360c0830185612de0565b81810360e0830152612fc58184612d05565b90509998505050505050505050565b600061018082019050612fea600083018f612dd1565b612ff7602083018e612dd1565b613004604083018d612dd1565b613011606083018c612dc2565b61301e608083018b612dc2565b61302b60a083018a612dc2565b61303860c0830189612dc2565b61304560e0830188612de0565b613053610100830187612bdb565b613061610120830186612dd1565b61306f610140830185612dc2565b61307d610160830184612dc2565b9d9c50505050505050505050505050565b6000604051905081810181811067ffffffffffffffff821117156130b157600080fd5b8060405250919050565b600067ffffffffffffffff8211156130d257600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b6000613191826131be565b9050919050565b6000819050919050565b60006fffffffffffffffffffffffffffffffff82169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b82818337600083830152505050565b60005b83811015613222578082015181840152602081019050613207565b83811115613231576000848401525b50505050565b6000601f19601f8301169050919050565b61325181613186565b811461325c57600080fd5b50565b61326881613198565b811461327357600080fd5b50565b61327f816131a2565b811461328a57600080fd5b50565b613296816131de565b81146132a157600080fd5b50565b6132ad816131e8565b81146132b857600080fd5b5056fea26469706673582212201a7788fae2535836127db097c31947419fdffd2715565d86151ca0e2d29a22d864736f6c63430006080033";


//
// Create Contract proxy class
let SampleContract = new web3.eth.Contract(abi);
const gasPrice = 1000;//web3.eth.gasPrice;
const gasPriceHex = web3.utils.numberToHex(gasPrice);
const gasLimitHex = web3.utils.numberToHex(4500000);


(async () => {
    const nonceval = await web3.eth.getTransactionCount(account1, "pending"); //'0x' + new Date().getTime();

    console.log(nonceval);

    var fTx = {
        nonce: nonceval,
        gasPrice: gasPriceHex,
        gasLimit: gasLimitHex,
        data: code,
        from: account1
    };

    var txx = new Tx(fTx);
    txx.sign(key1);

    var sTx =txx.serialize();


    const receipt = await web3.eth.sendSignedTransaction('0x' + sTx.toString('hex')).on('receipt', function(receipt){
        console.log(receipt);
    });
})();
