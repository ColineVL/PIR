const Web3 = require('web3');
var Tx = require('ethereumjs-tx');
let fs = require("fs");



// Web3 Initialisation
const provider = 'http://192.168.33.115:8545';
console.log("******************************************");
console.log("Using provider : " + provider);
console.log("******************************************");
var web3 = new Web3(new Web3.providers.HttpProvider(provider))


//////////////////////////////////////Account info for deployment///////////////////////////////////////////////////
var account1= "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73";
var key1 =new Buffer.from('8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63','hex');
/////////////////////////////////////////////////////////////////////////////////////////:

// Read the compiled contract code
// Compile with
// solc SampleContract.sol --combined-json abi,asm,ast,bin,bin-runtime,clone-bin,devdoc,interface,opcodes,srcmap,srcmap-runtime,userdoc > contracts.json
// let source = fs.readFileSync("/home/rsx14/IdeaProjects/PIR/Solidity/contracts.json");
// let contracts = JSON.parse(source)["contracts"];

// ABI description as JSON structure
let abi = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"provider","type":"address"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"insuranceDeposit","type":"uint256"},{"indexed":false,"internalType":"uint128","name":"minimumData","type":"uint128"},{"indexed":false,"internalType":"uint128","name":"deployTime","type":"uint128"},{"indexed":false,"internalType":"uint128","name":"endTime","type":"uint128"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint8","name":"depreciationType","type":"uint8"},{"indexed":false,"internalType":"string","name":"description","type":"string"}],"name":"NewDataReference","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encodedKeyHash","type":"bytes32"}],"name":"encodedKeyHash","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encryptedEncodedKey","type":"bytes32"}],"name":"encryptedEncodedKeyEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"keyDecoder","type":"bytes32"}],"name":"keyDecoder","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"fund","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"newClient","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"string","name":"TLE","type":"string"}],"name":"newTLE","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"referenceKey","type":"bytes32"}],"name":"referenceKey","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"funds","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"withdrawRefund","type":"event"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"TLEs","outputs":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"string","name":"TLE","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"}],"name":"buyReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_price","type":"uint256"},{"internalType":"uint128","name":"_minimumData","type":"uint128"},{"internalType":"uint128","name":"_referenceDuration","type":"uint128"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"},{"internalType":"uint8","name":"_depreciationType","type":"uint8"},{"internalType":"string","name":"_description","type":"string"}],"name":"createDataReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"dataReferences","outputs":[{"internalType":"uint256","name":"initialPrice","type":"uint256"},{"internalType":"uint256","name":"insuranceDeposit","type":"uint256"},{"internalType":"bytes32","name":"referenceKey","type":"bytes32"},{"internalType":"uint128","name":"minimumData","type":"uint128"},{"internalType":"uint128","name":"numberOfData","type":"uint128"},{"internalType":"uint128","name":"deployTime","type":"uint128"},{"internalType":"uint128","name":"endTime","type":"uint128"},{"internalType":"uint8","name":"depreciationType","type":"uint8"},{"internalType":"address","name":"provider","type":"address"},{"internalType":"uint256","name":"withdrawableFunds","type":"uint256"},{"internalType":"uint128","name":"numberOfDisputes","type":"uint128"},{"internalType":"uint128","name":"completedClients","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClientDisputes","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClients","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceKey","type":"uint256"}],"name":"getKeyDecoder","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getNumberOfData","outputs":[{"internalType":"uint128","name":"numberOfData","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getReferenceCurrentPrice","outputs":[{"internalType":"uint256","name":"price","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getTLEs","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"components":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"string","name":"TLE","type":"string"}],"internalType":"struct TLE_Contract.structTLE[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"raiseDispute","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_encodedKeyHash","type":"bytes32"}],"name":"setEncodedHashedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_encryptedEncodedKey","type":"bytes32"}],"name":"setEncryptedEncodedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_keyDecoder","type":"bytes32"}],"name":"setKeyDecoder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_referenceKey","type":"bytes32"}],"name":"setReferenceKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"string","name":"_spaceObject","type":"string"},{"internalType":"string","name":"_TLE","type":"string"}],"name":"setTLE","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"withdrawFunds","outputs":[],"stateMutability":"nonpayable","type":"function"}]

//[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]



// Smart contract EVM bytecode as hex
let code = '0x' + "60806040526000805534801561001457600080fd5b50613793806100246000396000f3fe6080604052600436106100fe5760003560e01c80637d918a2511610095578063ac231a9811610064578063ac231a9814610345578063b14b67871461036e578063ca90fee514610397578063e3752bbe146103d5578063ed95710014610412576100fe565b80637d918a25146102795780638656bbe9146102b657806392a0294f146102df578063a5c1674e1461031c576100fe565b8063293dca69116100d1578063293dca69146101af57806342dd519c146101d857806370f38314146102155780637a5087fb1461025d576100fe565b806307bbb8d414610103578063155dd5ee1461011f57806320a6bde91461014857806323bf426214610171575b600080fd5b61011d60048036038101906101189190612e8e565b61044f565b005b34801561012b57600080fd5b5061014660048036038101906101419190612e16565b61077c565b005b34801561015457600080fd5b5061016f600480360381019061016a9190612e8e565b610911565b005b34801561017d57600080fd5b5061019860048036038101906101939190612fea565b610aa4565b6040516101a6929190613304565b60405180910390f35b3480156101bb57600080fd5b506101d660048036038101906101d19190612eca565b610c12565b005b3480156101e457600080fd5b506101ff60048036038101906101fa9190612e16565b610dd6565b60405161020c9190613275565b60405180910390f35b34801561022157600080fd5b5061023c60048036038101906102379190612e16565b610efa565b6040516102549c9b9a999897969594939291906133f1565b60405180910390f35b61027760048036038101906102729190612f49565b61103c565b005b34801561028557600080fd5b506102a0600480360381019061029b9190612e16565b61143f565b6040516102ad919061335b565b60405180910390f35b3480156102c257600080fd5b506102dd60048036038101906102d89190612e8e565b611483565b005b3480156102eb57600080fd5b5061030660048036038101906103019190612e16565b611584565b6040516103139190613297565b60405180910390f35b34801561032857600080fd5b50610343600480360381019061033e9190612e16565b611664565b005b34801561035157600080fd5b5061036c60048036038101906103679190612e3f565b611b52565b005b34801561037a57600080fd5b5061039560048036038101906103909190612e3f565b611dc5565b005b3480156103a357600080fd5b506103be60048036038101906103b99190612e16565b611e91565b6040516103cc9291906132b2565b60405180910390f35b3480156103e157600080fd5b506103fc60048036038101906103f79190612e16565b6123e2565b6040516104099190613275565b60405180910390f35b34801561041e57600080fd5b5061043960048036038101906104349190612e16565b612644565b6040516104469190613376565b60405180910390f35b816000801b6001828154811061046157fe5b90600052602060002090600d0201600201541461047d57600080fd5b6001818154811061048a57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1642106104d557600080fd5b60006104e082612644565b9050803410156104ef57600080fd5b600182815481106104fc57fe5b90600052602060002090600d02016000015434111561051a57600080fd5b60018054905084111561052c57600080fd5b600015156001858154811061053d57fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161515146105a557600080fd5b600184815481106105b257fe5b90600052602060002090600d0201600701339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600180858154811061063257fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690831515021790555034600185815481106106a557fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550346001858154811061070557fe5b90600052602060002090600d0201600601600082825401925050819055503373ffffffffffffffffffffffffffffffffffffffff16847f4059ccbea539583e69b0db8efe5c16d1c5ddc863b12df52b3be3fa65029d8a6334864260405161076e93929190613391565b60405180910390a350505050565b806001818154811061078a57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146107f357600080fd5b620697806001838154811061080457fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16016fffffffffffffffffffffffffffffffff16421161085057600080fd5b6000801b6001838154811061086157fe5b90600052602060002090600d020160020154141561087e57600080fd5b60006001838154811061088d57fe5b90600052602060002090600d02016006015490506000600184815481106108b057fe5b90600052602060002090600d0201600601819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505015801561090b573d6000803e3d6000fd5b50505050565b81600115156001828154811061092357fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461098b57600080fd5b6000801b6001848154811061099c57fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541415610a505781600184815481106109ff57fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002050505b3373ffffffffffffffffffffffffffffffffffffffff16837fc9a5303ca56727b24e4955597b9bb74dd9bc6462dbad79d63dd393b1b7e5d10684604051610a979190613297565b60405180910390a3505050565b60026020528160005260406000208181548110610abd57fe5b906000526020600020906002020160009150915050806000018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b6a5780601f10610b3f57610100808354040283529160200191610b6a565b820191906000526020600020905b815481529060010190602001808311610b4d57829003601f168201915b505050505090806001018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c085780601f10610bdd57610100808354040283529160200191610c08565b820191906000526020600020905b815481529060010190602001808311610beb57829003601f168201915b5050505050905082565b8260018181548110610c2057fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610c8957600080fd5b610c91612add565b838160000181905250828160200181905250600260008681526020019081526020016000208190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000019080519060200190610cfc929190612af7565b506020820151816001019080519060200190610d19929190612af7565b50505060018581548110610d2957fe5b90600052602060002090600d0201600301601081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050847f0d24b8ac995fa8eca2b46e0246413d6123831e152dfb6a0cbd71df864ba2192b85604051610dc791906132e2565b60405180910390a25050505050565b60608160018181548110610de657fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610e4f57600080fd5b60018381548110610e5c57fe5b90600052602060002090600d0201600701805480602002602001604051908101604052809291908181526020018280548015610eed57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311610ea3575b5050505050915050919050565b60018181548110610f0757fe5b90600052602060002090600d02016000915090508060000154908060010154908060020154908060030160009054906101000a90046fffffffffffffffffffffffffffffffff16908060030160109054906101000a90046fffffffffffffffffffffffffffffffff16908060040160009054906101000a90046fffffffffffffffffffffffffffffffff16908060040160109054906101000a90046fffffffffffffffffffffffffffffffff16908060050160009054906101000a900460ff16908060050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff169080600601549080600a0160009054906101000a90046fffffffffffffffffffffffffffffffff169080600a0160109054906101000a90046fffffffffffffffffffffffffffffffff1690508c565b611044612b77565b868160000181815250503481602001818152505034816101200181815250508581606001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff1681525050828160e0019060ff16908160ff1681525050428160a001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff16815250504285018160c001906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff1681525050426fffffffffffffffffffffffffffffffff168160c001516fffffffffffffffffffffffffffffffff161161113b57600080fd5b3381610100019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505060018190806001815401808255809150506001900390600052602060002090600d020160009091909190915060008201518160000155602082015181600101556040820151816002015560608201518160030160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060808201518160030160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060a08201518160040160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060c08201518160040160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555060e08201518160050160006101000a81548160ff021916908360ff1602179055506101008201518160050160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610120820151816006015561014082015181600701908051906020019061134b929190612c67565b5061016082015181600a0160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555061018082015181600a0160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050503373ffffffffffffffffffffffffffffffffffffffff1660018080549050037f87df291311b02f282c5dcfc847fe75d49b00eded0dff5c3b8a5e9110ccca8e2e89348a428760c001518b8b8b60405161142e9897969594939291906134ab565b60405180910390a350505050505050565b60006001828154811061144e57fe5b90600052602060002090600d020160030160109054906101000a90046fffffffffffffffffffffffffffffffff169050919050565b816001818154811061149157fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146114fa57600080fd5b6000801b6001848154811061150b57fe5b90600052602060002090600d020160020154141561157f57816001848154811061153157fe5b90600052602060002090600d020160020181905550827f2a1b289fe6fe9bd89c1cfbbed506798801b402cafb0a3d93c29cb9c8aafed920836040516115769190613297565b60405180910390a25b505050565b600081600115156001828154811061159857fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461160057600080fd5b6001838154811061160d57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054915050919050565b80600115156001828154811061167657fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161515146116de57600080fd5b6000600183815481106116ed57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490506000811161174b57600080fd5b806001848154811061175957fe5b90600052602060002090600d020160060154101561177657600080fd5b6000801b6001848154811061178757fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414156117eb576117e683826128b9565b611b4d565b6000801b600184815481106117fc57fe5b90600052602060002090600d02016002015414611aec5760006001848154811061182257fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546001858154811061187e57fe5b90600052602060002090600d020160020154189050600184815481106118a057fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054816040516020016119009190613297565b60405160208183030381529060405280519060200120146119b2576119a16001858154811061192b57fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166001868154811061197857fe5b90600052602060002090600d0201600101548161199157fe5b0483612a8890919063ffffffff16565b91506119ad84836128b9565b611ae6565b600184815481106119bf57fe5b90600052602060002090600d020160030160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1660018581548110611a0c57fe5b90600052602060002090600d020160030160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161015611ae557611ad860018581548110611a6257fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1660018681548110611aaf57fe5b90600052602060002090600d02016001015481611ac857fe5b0483612a8890919063ffffffff16565b9150611ae484836128b9565b5b5b50611b4c565b60018381548110611af957fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16421115611b4b57611b4a83826128b9565b5b5b5b505050565b8260018181548110611b6057fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611bc957600080fd5b600060018581548110611bd857fe5b90600052602060002090600d020160080160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541115611dbf576000801b60018581548110611c3e57fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541415611dbe578160018581548110611ca157fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555060018481548110611d0057fe5b90600052602060002090600d0201600a01601081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550508273ffffffffffffffffffffffffffffffffffffffff16847f557b07a87337236272a12c29e39bd292a192d7c1811cc6994635d23284e935df84604051611db59190613297565b60405180910390a35b5b50505050565b8260018181548110611dd357fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611e3c57600080fd5b8273ffffffffffffffffffffffffffffffffffffffff16847fd57e7ea23bb50dbe8316bec30809240f566976ab1b1e4e37e76c7bb3e0b645f084604051611e839190613297565b60405180910390a350505050565b6000606060018381548110611ea257fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1642108015611f1057506000801b60018481548110611efc57fe5b90600052602060002090600d020160020154145b15612209576000801b60018481548110611f2657fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141580611feb575060018381548110611f8a57fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b611ff457600080fd5b6001838154811061200157fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546002600085815260200190815260200160002080805480602002602001604051908101604052809291908181526020016000905b828210156121fa5783829060005260206000209060020201604051806040016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156121405780601f1061211557610100808354040283529160200191612140565b820191906000526020600020905b81548152906001019060200180831161212357829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156121e25780601f106121b7576101008083540402835291602001916121e2565b820191906000526020600020905b8154815290600101906020018083116121c557829003601f168201915b50505050508152505081526020019060010190612084565b505050509050915091506123dd565b6001838154811061221657fe5b90600052602060002090600d0201600201546002600085815260200190815260200160002080805480602002602001604051908101604052809291908181526020016000905b828210156123d25783829060005260206000209060020201604051806040016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156123185780601f106122ed57610100808354040283529160200191612318565b820191906000526020600020905b8154815290600101906020018083116122fb57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156123ba5780601f1061238f576101008083540402835291602001916123ba565b820191906000526020600020905b81548152906001019060200180831161239d57829003601f168201915b5050505050815250508152602001906001019061225c565b505050509050915091505b915091565b606081600181815481106123f257fe5b90600052602060002090600d020160050160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461245b57600080fd5b60006001848154811061246a57fe5b90600052602060002090600d0201600a0160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16905060608167ffffffffffffffff811180156124c557600080fd5b506040519080825280602002602001820160405280156124f45781602001602082028036833780820191505090505b509050600080600090505b6001878154811061250c57fe5b90600052602060002090600d020160070180549050811015612637576001878154811061253557fe5b90600052602060002090600d0201600701818154811061255157fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915060006001888154811061258d57fe5b90600052602060002090600d020160080160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141561262a57818382815181106125ef57fe5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505b80806001019150506124ff565b5081945050505050919050565b6000806001838154811061265457fe5b90600052602060002090600d020160000154905060006001848154811061267757fe5b90600052602060002090600d020160050160009054906101000a900460ff16905060018160ff16141561279b576000600185815481106126b357fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff16600186815481106126ee57fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16036fffffffffffffffffffffffffffffffff16905060006001868154811061274057fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1642039050818185028161278f57fe5b048403935050506128af565b60028160ff1614156128ae576000600185815481106127b657fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff16600186815481106127f157fe5b90600052602060002090600d020160040160109054906101000a90046fffffffffffffffffffffffffffffffff16036fffffffffffffffffffffffffffffffff16905060006001868154811061284357fe5b90600052602060002090600d020160040160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff164203905083828286600202028161289657fe5b048384028384880202816128a657fe5b040301935050505b5b8192505050919050565b80600183815481106128c757fe5b90600052602060002090600d02016006015410156128e457600080fd5b600182815481106128f157fe5b90600052602060002090600d0201600a01600081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505060006001838154811061296e57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555080600183815481106129ce57fe5b90600052602060002090600d0201600601600082825403925050819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015612a32573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff16827f54cd3e4964cbbb07875e24bd38c626e4572701f70d0992629dfbad3a0a6597ec8342604051612a7c9291906133c8565b60405180910390a35050565b600080828401905083811015612ad3576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612aca9061333b565b60405180910390fd5b8091505092915050565b604051806040016040528060608152602001606081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10612b3857805160ff1916838001178555612b66565b82800160010185558215612b66579182015b82811115612b65578251825591602001919060010190612b4a565b5b509050612b739190612cf1565b5090565b604051806101a0016040528060008152602001600081526020016000801916815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff168152602001600060ff168152602001600073ffffffffffffffffffffffffffffffffffffffff168152602001600081526020016060815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff1681525090565b828054828255906000526020600020908101928215612ce0579160200282015b82811115612cdf5782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190612c87565b5b509050612ced9190612d16565b5090565b612d1391905b80821115612d0f576000816000905550600101612cf7565b5090565b90565b612d5691905b80821115612d5257600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905550600101612d1c565b5090565b90565b600081359050612d68816136ea565b92915050565b600081359050612d7d81613701565b92915050565b600082601f830112612d9457600080fd5b8135612da7612da28261355d565b613530565b91508082526020830160208301858383011115612dc357600080fd5b612dce838284613697565b50505092915050565b600081359050612de681613718565b92915050565b600081359050612dfb8161372f565b92915050565b600081359050612e1081613746565b92915050565b600060208284031215612e2857600080fd5b6000612e3684828501612dec565b91505092915050565b600080600060608486031215612e5457600080fd5b6000612e6286828701612dec565b9350506020612e7386828701612d59565b9250506040612e8486828701612d6e565b9150509250925092565b60008060408385031215612ea157600080fd5b6000612eaf85828601612dec565b9250506020612ec085828601612d6e565b9150509250929050565b600080600060608486031215612edf57600080fd5b6000612eed86828701612dec565b935050602084013567ffffffffffffffff811115612f0a57600080fd5b612f1686828701612d83565b925050604084013567ffffffffffffffff811115612f3357600080fd5b612f3f86828701612d83565b9150509250925092565b60008060008060008060c08789031215612f6257600080fd5b6000612f7089828a01612dec565b9650506020612f8189828a01612dd7565b9550506040612f9289828a01612dd7565b9450506060612fa389828a01612d6e565b9350506080612fb489828a01612e01565b92505060a087013567ffffffffffffffff811115612fd157600080fd5b612fdd89828a01612d83565b9150509295509295509295565b60008060408385031215612ffd57600080fd5b600061300b85828601612dec565b925050602061301c85828601612dec565b9150509250929050565b60006130328383613052565b60208301905092915050565b600061304a8383613204565b905092915050565b61305b81613628565b82525050565b61306a81613628565b82525050565b600061307b826135a9565b61308581856135e4565b935061309083613589565b8060005b838110156130c15781516130a88882613026565b97506130b3836135ca565b925050600181019050613094565b5085935050505092915050565b60006130d9826135b4565b6130e381856135f5565b9350836020820285016130f585613599565b8060005b858110156131315784840389528151613112858261303e565b945061311d836135d7565b925060208a019950506001810190506130f9565b50829750879550505050505092915050565b61314c8161363a565b82525050565b600061315d826135bf565b6131678185613606565b93506131778185602086016136a6565b613180816136d9565b840191505092915050565b6000613196826135bf565b6131a08185613617565b93506131b08185602086016136a6565b6131b9816136d9565b840191505092915050565b60006131d1601b83613617565b91507f536166654d6174683a206164646974696f6e206f766572666c6f7700000000006000830152602082019050919050565b600060408301600083015184820360008601526132218282613152565b9150506020830151848203602086015261323b8282613152565b9150508091505092915050565b61325181613644565b82525050565b61326081613680565b82525050565b61326f8161368a565b82525050565b6000602082019050818103600083015261328f8184613070565b905092915050565b60006020820190506132ac6000830184613143565b92915050565b60006040820190506132c76000830185613143565b81810360208301526132d981846130ce565b90509392505050565b600060208201905081810360008301526132fc818461318b565b905092915050565b6000604082019050818103600083015261331e818561318b565b90508181036020830152613332818461318b565b90509392505050565b60006020820190508181036000830152613354816131c4565b9050919050565b60006020820190506133706000830184613248565b92915050565b600060208201905061338b6000830184613257565b92915050565b60006060820190506133a66000830186613257565b6133b36020830185613143565b6133c06040830184613257565b949350505050565b60006040820190506133dd6000830185613257565b6133ea6020830184613257565b9392505050565b600061018082019050613407600083018f613257565b613414602083018e613257565b613421604083018d613143565b61342e606083018c613248565b61343b608083018b613248565b61344860a083018a613248565b61345560c0830189613248565b61346260e0830188613266565b613470610100830187613061565b61347e610120830186613257565b61348c610140830185613248565b61349a610160830184613248565b9d9c50505050505050505050505050565b6000610100820190506134c1600083018b613257565b6134ce602083018a613257565b6134db6040830189613248565b6134e86060830188613248565b6134f56080830187613248565b61350260a0830186613143565b61350f60c0830185613266565b81810360e0830152613521818461318b565b90509998505050505050505050565b6000604051905081810181811067ffffffffffffffff8211171561355357600080fd5b8060405250919050565b600067ffffffffffffffff82111561357457600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600061363382613660565b9050919050565b6000819050919050565b60006fffffffffffffffffffffffffffffffff82169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b82818337600083830152505050565b60005b838110156136c45780820151818401526020810190506136a9565b838111156136d3576000848401525b50505050565b6000601f19601f8301169050919050565b6136f381613628565b81146136fe57600080fd5b50565b61370a8161363a565b811461371557600080fd5b50565b61372181613644565b811461372c57600080fd5b50565b61373881613680565b811461374357600080fd5b50565b61374f8161368a565b811461375a57600080fd5b5056fea26469706673582212206523ac8c18be76c95f6ec642cb283faf38aeef3227b657148f8d5d5b63a8b61064736f6c63430006080033";


//
// Create Contract proxy class
let SampleContract = new web3.eth.Contract(abi);
const gasPrice = 1000;//web3.eth.gasPrice;
const gasPriceHex = web3.utils.numberToHex(gasPrice);
const gasLimitHex = web3.utils.numberToHex(4500000);


(async () => {
    const nonceval = await web3.eth.getTransactionCount(account1, "pending"); //'0x' + new Date().getTime();

    console.log(nonceval);

    var fTx = {
        nonce: nonceval,
        gasPrice: gasPriceHex,
        gasLimit: gasLimitHex,
        data: code,
        from: account1
    };

    var txx = new Tx(fTx);
    txx.sign(key1);

    var sTx =txx.serialize();


    const receipt = await web3.eth.sendSignedTransaction('0x' + sTx.toString('hex')).on('receipt', function(receipt){
        console.log(receipt);
    });
})();
