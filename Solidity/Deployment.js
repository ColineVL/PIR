const Web3 = require('web3');
var Tx = require('ethereumjs-tx');
let fs = require("fs");



// Web3 Initialisation
const provider = 'http://192.168.33.115:8545';
console.log("******************************************");
console.log("Using provider : " + provider);
console.log("******************************************");
var web3 = new Web3(new Web3.providers.HttpProvider(provider))


//////////////////////////////////////Account info for deployment///////////////////////////////////////////////////
var account1= "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73";
var key1 =new Buffer.from('8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63','hex');
/////////////////////////////////////////////////////////////////////////////////////////:

// Read the compiled contract code
// Compile with
// solc SampleContract.sol --combined-json abi,asm,ast,bin,bin-runtime,clone-bin,devdoc,interface,opcodes,srcmap,srcmap-runtime,userdoc > contracts.json
// let source = fs.readFileSync("/home/rsx14/IdeaProjects/PIR/Solidity/contracts.json");
// let contracts = JSON.parse(source)["contracts"];

// ABI description as JSON structure
let abi = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encodedKeyHash","type":"bytes32"}],"name":"encodedKeyHash","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"encryptedEncodedKey","type":"bytes32"}],"name":"encryptedEncodedKeyEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"bytes32","name":"keyDecoder","type":"bytes32"}],"name":"keyDecoder","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"fund","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"newClient","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"provider","type":"address"},{"indexed":false,"internalType":"uint256","name":"initialPrice","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"insuranceDeposit","type":"uint256"},{"indexed":false,"internalType":"uint64","name":"minimumData","type":"uint64"},{"indexed":false,"internalType":"uint64","name":"deployTime","type":"uint64"},{"indexed":false,"internalType":"uint64","name":"endTime","type":"uint64"},{"indexed":false,"internalType":"bytes32","name":"publicKeyDH","type":"bytes32"},{"indexed":false,"internalType":"uint8","name":"depreciationType","type":"uint8"},{"indexed":false,"internalType":"string","name":"description","type":"string"}],"name":"newDataReference","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"string","name":"spaceObject","type":"string"}],"name":"newTLE","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"referenceKey","type":"bytes32"}],"name":"referenceKey","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"referenceId","type":"uint256"},{"indexed":true,"internalType":"address","name":"client","type":"address"},{"indexed":false,"internalType":"uint256","name":"funds","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"time","type":"uint256"}],"name":"withdrawRefund","type":"event"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"TLEs","outputs":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"string","name":"TLE","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"}],"name":"buyReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_initialPrice","type":"uint256"},{"internalType":"uint64","name":"_minimumData","type":"uint64"},{"internalType":"uint64","name":"_referenceDuration","type":"uint64"},{"internalType":"bytes32","name":"_publicKeyDH","type":"bytes32"},{"internalType":"uint8","name":"_depreciationType","type":"uint8"},{"internalType":"string","name":"_description","type":"string"}],"name":"createDataReference","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClientDisputes","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getClients","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceKey","type":"uint256"}],"name":"getKeyDecoder","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getNumberOfData","outputs":[{"internalType":"uint128","name":"numberOfData","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getReferenceCurrentPrice","outputs":[{"internalType":"uint256","name":"price","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"getTLEs","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"components":[{"internalType":"string","name":"spaceObject","type":"string"},{"internalType":"string","name":"TLE","type":"string"}],"internalType":"struct TLE_Contract.structTLE[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"raiseDispute","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_encodedKeyHash","type":"bytes32"}],"name":"setEncodedHashedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_encryptedEncodedKey","type":"bytes32"}],"name":"setEncryptedEncodedKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"bytes32","name":"_keyDecoder","type":"bytes32"}],"name":"setKeyDecoder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"bytes32","name":"_referenceKey","type":"bytes32"}],"name":"setReferenceKey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"},{"internalType":"string","name":"_spaceObject","type":"string"},{"internalType":"string","name":"_TLE","type":"string"}],"name":"setTLE","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_referenceId","type":"uint256"}],"name":"withdrawFunds","outputs":[],"stateMutability":"nonpayable","type":"function"}]

//[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]



// Smart contract EVM bytecode as hex
let code = '0x' + "608060405234801561001057600080fd5b50613354806100206000396000f3fe6080604052600436106100f35760003560e01c80638656bbe91161008a578063b14b678711610059578063b14b67871461032f578063ca90fee514610358578063e3752bbe14610396578063ed957100146103d3576100f3565b80638656bbe91461026357806392a0294f1461028c578063a5c1674e146102c9578063ac231a9814610306576100f3565b8063293dca69116100c6578063293dca69146101a45780633e24e56a146101cd57806342dd519c146101e95780637d918a2514610226576100f3565b806307bbb8d4146100f8578063155dd5ee1461011457806320a6bde91461013d57806323bf426214610166575b600080fd5b610112600480360381019061010d9190612b1f565b610410565b005b34801561012057600080fd5b5061013b60048036038101906101369190612aa7565b61071c565b005b34801561014957600080fd5b50610164600480360381019061015f9190612b1f565b61089d565b005b34801561017257600080fd5b5061018d60048036038101906101889190612bda565b610a1e565b60405161019b929190612f7f565b60405180910390f35b3480156101b057600080fd5b506101cb60048036038101906101c69190612b5b565b610b8c565b005b6101e760048036038101906101e29190612c16565b610d38565b005b3480156101f557600080fd5b50610210600480360381019061020b9190612aa7565b6110be565b60405161021d9190612ed5565b60405180910390f35b34801561023257600080fd5b5061024d60048036038101906102489190612aa7565b6111e2565b60405161025a9190612fb6565b60405180910390f35b34801561026f57600080fd5b5061028a60048036038101906102859190612b1f565b611227565b005b34801561029857600080fd5b506102b360048036038101906102ae9190612aa7565b611337565b6040516102c09190612f12565b60405180910390f35b3480156102d557600080fd5b506102f060048036038101906102eb9190612aa7565b611405565b6040516102fd9190612ef7565b60405180910390f35b34801561031257600080fd5b5061032d60048036038101906103289190612ad0565b6118a7565b005b34801561033b57600080fd5b5061035660048036038101906103519190612ad0565b611b28565b005b34801561036457600080fd5b5061037f600480360381019061037a9190612aa7565b611bff565b60405161038d929190612f2d565b60405180910390f35b3480156103a257600080fd5b506103bd60048036038101906103b89190612aa7565b612140565b6040516103ca9190612ed5565b60405180910390f35b3480156103df57600080fd5b506103fa60048036038101906103f59190612aa7565b6123a0565b6040516104079190612fd1565b60405180910390f35b816000801b6000828154811061042257fe5b90600052602060002090600d0201600401541461043e57600080fd5b6000818154811061044b57fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff1667ffffffffffffffff16421061048657600080fd5b6000610491826123a0565b9050803410156104a057600080fd5b600082815481106104ad57fe5b90600052602060002090600d0201600001543411156104cb57600080fd5b60001515600085815481106104dc57fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615151461054457600080fd5b6000848154811061055157fe5b90600052602060002090600d0201600701339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600085815481106105d257fe5b90600052602060002090600d020160090160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550346000858154811061064557fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555034600085815481106106a557fe5b90600052602060002090600d0201600201600082825401925050819055503373ffffffffffffffffffffffffffffffffffffffff16847f4059ccbea539583e69b0db8efe5c16d1c5ddc863b12df52b3be3fa65029d8a6334864260405161070e93929190612fec565b60405180910390a350505050565b806000818154811061072a57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461079357600080fd5b601e600083815481106107a257fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff160167ffffffffffffffff1642116107de57600080fd5b6000801b600083815481106107ef57fe5b90600052602060002090600d020160040154141561080c57600080fd5b600080838154811061081a57fe5b90600052602060002090600d0201600201549050600080848154811061083c57fe5b90600052602060002090600d0201600201819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015610897573d6000803e3d6000fd5b50505050565b8160008082815481106108ac57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541161090557600080fd5b6000801b6000848154811061091657fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414156109ca57816000848154811061097957fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002050505b3373ffffffffffffffffffffffffffffffffffffffff16837fc9a5303ca56727b24e4955597b9bb74dd9bc6462dbad79d63dd393b1b7e5d10684604051610a119190612f12565b60405180910390a3505050565b60016020528160005260406000208181548110610a3757fe5b906000526020600020906002020160009150915050806000018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610ae45780601f10610ab957610100808354040283529160200191610ae4565b820191906000526020600020905b815481529060010190602001808311610ac757829003601f168201915b505050505090806001018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b825780601f10610b5757610100808354040283529160200191610b82565b820191906000526020600020905b815481529060010190602001808311610b6557829003601f168201915b5050505050905082565b8260008181548110610b9a57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610c0357600080fd5b610c0b61278e565b838160000181905250828160200181905250600160008681526020019081526020016000208190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000019080519060200190610c769291906127a8565b506020820151816001019080519060200190610c939291906127a8565b50505060008581548110610ca357fe5b90600052602060002090600d0201600501600881819054906101000a900467ffffffffffffffff168092919060010191906101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555050847f0d24b8ac995fa8eca2b46e0246413d6123831e152dfb6a0cbd71df864ba2192b85604051610d299190612f5d565b60405180910390a25050505050565b610d40612828565b868160000181815250503481602001818152505034816040018181525050858160a0019067ffffffffffffffff16908167ffffffffffffffff16815250508281610120019060ff16908160ff1681525050428160e0019067ffffffffffffffff16908167ffffffffffffffff168152505042850181610100019067ffffffffffffffff16908167ffffffffffffffff16815250504267ffffffffffffffff1681610100015167ffffffffffffffff1611610df957600080fd5b33816060019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505060008190806001815401808255809150506001900390600052602060002090600d020160009091909190915060008201518160000155602082015181600101556040820151816002015560608201518160030160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506080820151816004015560a08201518160050160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060c08201518160050160086101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060e08201518160050160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506101008201518160050160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506101208201518160060160006101000a81548160ff021916908360ff160217905550610140820151816007019080519060200190610fc89291906128f8565b5061016082015181600a0160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555061018082015181600a0160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050503373ffffffffffffffffffffffffffffffffffffffff166001600080549050037fc1fe646c8e19f25897b021414c652720d8350cd9d63596199ee8dc136fdcd76489348a428761010001518b8b8b6040516110ad98979695949392919061304c565b60405180910390a350505050505050565b606081600081815481106110ce57fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461113757600080fd5b6000838154811061114457fe5b90600052602060002090600d02016007018054806020026020016040519081016040528092919081815260200182805480156111d557602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001906001019080831161118b575b5050505050915050919050565b60008082815481106111f057fe5b90600052602060002090600d020160050160089054906101000a900467ffffffffffffffff1667ffffffffffffffff169050919050565b816000818154811061123557fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461129e57600080fd5b6000801b600084815481106112af57fe5b90600052602060002090600d0201600401541480156112d157506000801b8214155b156113325781600084815481106112e457fe5b90600052602060002090600d020160040181905550827f2a1b289fe6fe9bd89c1cfbbed506798801b402cafb0a3d93c29cb9c8aafed920836040516113299190612f12565b60405180910390a25b505050565b600081600080828154811061134857fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054116113a157600080fd5b600083815481106113ae57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054915050919050565b600081600080828154811061141657fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541161146f57600080fd5b600080848154811061147d57fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905080600085815481106114dc57fe5b90600052602060002090600d02016002015410156114f957600080fd5b6000801b6000858154811061150a57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414156115735761156984826125c0565b60019250506118a1565b6000801b6000858154811061158457fe5b90600052602060002090600d020160040154146118425760008085815481106115a957fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546000868154811061160557fe5b90600052602060002090600d0201600401541890506000858154811061162757fe5b90600052602060002090600d0201600b0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054816040516020016116879190612f12565b604051602081830303815290604052805190602001201461172f57600085815481106116af57fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16600086815481106116fc57fe5b90600052602060002090600d0201600101548161171557fe5b048201915061172485836125c0565b6001935050506118a1565b6000858154811061173c57fe5b90600052602060002090600d020160050160009054906101000a900467ffffffffffffffff1667ffffffffffffffff166000868154811061177957fe5b90600052602060002090600d020160050160089054906101000a900467ffffffffffffffff1667ffffffffffffffff16101561183c57600085815481106117bc57fe5b90600052602060002090600d0201600a0160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff166000868154811061180957fe5b90600052602060002090600d0201600101548161182257fe5b048201915061183185836125c0565b6001935050506118a1565b5061189b565b6000848154811061184f57fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff1667ffffffffffffffff1642111561189a5761189084826125c0565b60019250506118a1565b5b60009250505b50919050565b82600081815481106118b557fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461191e57600080fd5b600080858154811061192c57fe5b90600052602060002090600d020160080160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541115611b22576000801b6000858154811061199257fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541480156119f157506000801b8214155b15611b21578160008581548110611a0457fe5b90600052602060002090600d0201600c0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555060008481548110611a6357fe5b90600052602060002090600d0201600a01601081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550508273ffffffffffffffffffffffffffffffffffffffff16847f557b07a87337236272a12c29e39bd292a192d7c1811cc6994635d23284e935df84604051611b189190612f12565b60405180910390a35b5b50505050565b8260008181548110611b3657fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611b9f57600080fd5b6000801b8214611bf9578273ffffffffffffffffffffffffffffffffffffffff16847fd57e7ea23bb50dbe8316bec30809240f566976ab1b1e4e37e76c7bb3e0b645f084604051611bf09190612f12565b60405180910390a35b50505050565b6000606060008381548110611c1057fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff1667ffffffffffffffff1642108015611c6e57506000801b60008481548110611c5a57fe5b90600052602060002090600d020160040154145b15611f67576000801b60008481548110611c8457fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141580611d49575060008381548110611ce857fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b611d5257600080fd5b60008381548110611d5f57fe5b90600052602060002090600d0201600c0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546001600085815260200190815260200160002080805480602002602001604051908101604052809291908181526020016000905b82821015611f585783829060005260206000209060020201604051806040016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611e9e5780601f10611e7357610100808354040283529160200191611e9e565b820191906000526020600020905b815481529060010190602001808311611e8157829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611f405780601f10611f1557610100808354040283529160200191611f40565b820191906000526020600020905b815481529060010190602001808311611f2357829003601f168201915b50505050508152505081526020019060010190611de2565b5050505090509150915061213b565b60008381548110611f7457fe5b90600052602060002090600d0201600401546001600085815260200190815260200160002080805480602002602001604051908101604052809291908181526020016000905b828210156121305783829060005260206000209060020201604051806040016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156120765780601f1061204b57610100808354040283529160200191612076565b820191906000526020600020905b81548152906001019060200180831161205957829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156121185780601f106120ed57610100808354040283529160200191612118565b820191906000526020600020905b8154815290600101906020018083116120fb57829003601f168201915b50505050508152505081526020019060010190611fba565b505050509050915091505b915091565b6060816000818154811061215057fe5b90600052602060002090600d020160030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146121b957600080fd5b60008084815481106121c757fe5b90600052602060002090600d0201600a0160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16905060608167ffffffffffffffff8111801561222257600080fd5b506040519080825280602002602001820160405280156122515781602001602082028036833780820191505090505b509050600080600090505b6000878154811061226957fe5b90600052602060002090600d020160070180549050811015612393576000878154811061229257fe5b90600052602060002090600d020160070181815481106122ae57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915060008088815481106122e957fe5b90600052602060002090600d020160080160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541415612386578183828151811061234b57fe5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505b808060010191505061225c565b5081945050505050919050565b600080600083815481106123b057fe5b90600052602060002090600d020160000154905060008084815481106123d257fe5b90600052602060002090600d020160060160009054906101000a900460ff16905060018160ff1614156124cc57600080858154811061240d57fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff166000868154811061244057fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff160367ffffffffffffffff169050600080868154811061248157fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff1667ffffffffffffffff164203905081818502816124c057fe5b048403935050506125b6565b60028160ff1614156125b55760008085815481106124e657fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff166000868154811061251957fe5b90600052602060002090600d020160050160189054906101000a900467ffffffffffffffff160367ffffffffffffffff169050600080868154811061255a57fe5b90600052602060002090600d020160050160109054906101000a900467ffffffffffffffff1667ffffffffffffffff164203905083828286600202028161259d57fe5b048384028384880202816125ad57fe5b040301935050505b5b8192505050919050565b80600083815481106125ce57fe5b90600052602060002090600d02016002015410156125eb57600080fd5b600082815481106125f857fe5b90600052602060002090600d0201600a01600081819054906101000a90046fffffffffffffffffffffffffffffffff168092919060010191906101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555050600080838154811061267457fe5b90600052602060002090600d020160080160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555080600083815481106126d457fe5b90600052602060002090600d0201600201600082825403925050819055503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015612738573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff16827f54cd3e4964cbbb07875e24bd38c626e4572701f70d0992629dfbad3a0a6597ec8342604051612782929190613023565b60405180910390a35050565b604051806040016040528060608152602001606081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106127e957805160ff1916838001178555612817565b82800160010185558215612817579182015b828111156128165782518255916020019190600101906127fb565b5b5090506128249190612982565b5090565b604051806101a00160405280600081526020016000815260200160008152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160008019168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff168152602001600067ffffffffffffffff168152602001600060ff1681526020016060815260200160006fffffffffffffffffffffffffffffffff16815260200160006fffffffffffffffffffffffffffffffff1681525090565b828054828255906000526020600020908101928215612971579160200282015b828111156129705782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190612918565b5b50905061297e91906129a7565b5090565b6129a491905b808211156129a0576000816000905550600101612988565b5090565b90565b6129e791905b808211156129e357600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055506001016129ad565b5090565b90565b6000813590506129f9816132ab565b92915050565b600081359050612a0e816132c2565b92915050565b600082601f830112612a2557600080fd5b8135612a38612a33826130fe565b6130d1565b91508082526020830160208301858383011115612a5457600080fd5b612a5f838284613258565b50505092915050565b600081359050612a77816132d9565b92915050565b600081359050612a8c816132f0565b92915050565b600081359050612aa181613307565b92915050565b600060208284031215612ab957600080fd5b6000612ac784828501612a68565b91505092915050565b600080600060608486031215612ae557600080fd5b6000612af386828701612a68565b9350506020612b04868287016129ea565b9250506040612b15868287016129ff565b9150509250925092565b60008060408385031215612b3257600080fd5b6000612b4085828601612a68565b9250506020612b51858286016129ff565b9150509250929050565b600080600060608486031215612b7057600080fd5b6000612b7e86828701612a68565b935050602084013567ffffffffffffffff811115612b9b57600080fd5b612ba786828701612a14565b925050604084013567ffffffffffffffff811115612bc457600080fd5b612bd086828701612a14565b9150509250925092565b60008060408385031215612bed57600080fd5b6000612bfb85828601612a68565b9250506020612c0c85828601612a68565b9150509250929050565b60008060008060008060c08789031215612c2f57600080fd5b6000612c3d89828a01612a68565b9650506020612c4e89828a01612a7d565b9550506040612c5f89828a01612a7d565b9450506060612c7089828a016129ff565b9350506080612c8189828a01612a92565b92505060a087013567ffffffffffffffff811115612c9e57600080fd5b612caa89828a01612a14565b9150509295509295509295565b6000612cc38383612ce3565b60208301905092915050565b6000612cdb8383612e55565b905092915050565b612cec816131c9565b82525050565b6000612cfd8261314a565b612d078185613185565b9350612d128361312a565b8060005b83811015612d43578151612d2a8882612cb7565b9750612d358361316b565b925050600181019050612d16565b5085935050505092915050565b6000612d5b82613155565b612d658185613196565b935083602082028501612d778561313a565b8060005b85811015612db35784840389528151612d948582612ccf565b9450612d9f83613178565b925060208a01995050600181019050612d7b565b50829750879550505050505092915050565b612dce816131db565b82525050565b612ddd816131e7565b82525050565b6000612dee82613160565b612df881856131a7565b9350612e08818560208601613267565b612e118161329a565b840191505092915050565b6000612e2782613160565b612e3181856131b8565b9350612e41818560208601613267565b612e4a8161329a565b840191505092915050565b60006040830160008301518482036000860152612e728282612de3565b91505060208301518482036020860152612e8c8282612de3565b9150508091505092915050565b612ea2816131f1565b82525050565b612eb18161322d565b82525050565b612ec081613237565b82525050565b612ecf8161324b565b82525050565b60006020820190508181036000830152612eef8184612cf2565b905092915050565b6000602082019050612f0c6000830184612dc5565b92915050565b6000602082019050612f276000830184612dd4565b92915050565b6000604082019050612f426000830185612dd4565b8181036020830152612f548184612d50565b90509392505050565b60006020820190508181036000830152612f778184612e1c565b905092915050565b60006040820190508181036000830152612f998185612e1c565b90508181036020830152612fad8184612e1c565b90509392505050565b6000602082019050612fcb6000830184612e99565b92915050565b6000602082019050612fe66000830184612ea8565b92915050565b60006060820190506130016000830186612ea8565b61300e6020830185612dd4565b61301b6040830184612ea8565b949350505050565b60006040820190506130386000830185612ea8565b6130456020830184612ea8565b9392505050565b600061010082019050613062600083018b612ea8565b61306f602083018a612ea8565b61307c6040830189612eb7565b6130896060830188612eb7565b6130966080830187612eb7565b6130a360a0830186612dd4565b6130b060c0830185612ec6565b81810360e08301526130c28184612e1c565b90509998505050505050505050565b6000604051905081810181811067ffffffffffffffff821117156130f457600080fd5b8060405250919050565b600067ffffffffffffffff82111561311557600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b60006131d48261320d565b9050919050565b60008115159050919050565b6000819050919050565b60006fffffffffffffffffffffffffffffffff82169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600067ffffffffffffffff82169050919050565b600060ff82169050919050565b82818337600083830152505050565b60005b8381101561328557808201518184015260208101905061326a565b83811115613294576000848401525b50505050565b6000601f19601f8301169050919050565b6132b4816131c9565b81146132bf57600080fd5b50565b6132cb816131e7565b81146132d657600080fd5b50565b6132e28161322d565b81146132ed57600080fd5b50565b6132f981613237565b811461330457600080fd5b50565b6133108161324b565b811461331b57600080fd5b5056fea26469706673582212205f527578a43ba005602a047b7fb8721f627e4bbe62e87ba77ea5ff2d185a5ca364736f6c63430006080033";


//
// Create Contract proxy class
let SampleContract = new web3.eth.Contract(abi);
const gasPrice = 1000;//web3.eth.gasPrice;
const gasPriceHex = web3.utils.numberToHex(gasPrice);
const gasLimitHex = web3.utils.numberToHex(4500000);


(async () => {
    const nonceval = await web3.eth.getTransactionCount(account1, "pending"); //'0x' + new Date().getTime();

    console.log(nonceval);

    var fTx = {
        nonce: nonceval,
        gasPrice: gasPriceHex,
        gasLimit: gasLimitHex,
        data: code,
        from: account1
    };

    var txx = new Tx(fTx);
    txx.sign(key1);

    var sTx =txx.serialize();


    const receipt = await web3.eth.sendSignedTransaction('0x' + sTx.toString('hex')).on('receipt', function(receipt){
        console.log(receipt);
    });
})();
